---
# SecretStore for Vault in same namespace
apiVersion: external-secrets.io/v1beta1
kind: SecretStore
metadata:
  name: vault-backend
  namespace: default
spec:
  provider:
    vault:
      server: "https://vault.example.com"
      path: "secret"
      version: "v2"
      auth:
        kubernetes:
          mountPath: "kubernetes"
          role: "demo"

---
# ClusterSecretStore for shared Vault access
apiVersion: external-secrets.io/v1beta1
kind: ClusterSecretStore
metadata:
  name: global-vault
spec:
  provider:
    vault:
      server: "https://vault.example.com"
      path: "secret"
      version: "v2"
      auth:
        kubernetes:
          mountPath: "kubernetes"
          role: "global"

---
# ExternalSecret using SecretStore with explicit target name
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: app-secrets
  namespace: default
spec:
  secretStoreRef:
    name: vault-backend
    kind: SecretStore
  target:
    name: app-credentials
    creationPolicy: Owner
  data:
  - secretKey: password
    remoteRef:
      key: secret/data/myapp
      property: password
  - secretKey: api-key
    remoteRef:
      key: secret/data/myapp
      property: api_key

---
# ExternalSecret using ClusterSecretStore with default name
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: database-secrets
  namespace: default
spec:
  secretStoreRef:
    name: global-vault
    kind: ClusterSecretStore
  # No target.name specified - will use ExternalSecret name
  data:
  - secretKey: db-password
    remoteRef:
      key: secret/data/database
      property: password
  - secretKey: db-username
    remoteRef:
      key: secret/data/database
      property: username

---
# The Secret will be created by external-secrets operator
# This is just for reference
apiVersion: v1
kind: Secret
metadata:
  name: app-credentials
  namespace: default
  labels:
    external-secrets.io/name: app-secrets
type: Opaque
data:
  password: cGFzc3dvcmQxMjM=  # base64 encoded
  api-key: YXBpa2V5NDU2=      # base64 encoded
