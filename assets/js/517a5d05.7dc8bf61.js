"use strict";(globalThis.webpackChunkspectre_docs=globalThis.webpackChunkspectre_docs||[]).push([[5007],{3951:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>d,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"architecture/block-format","title":"Block Format Reference","description":"Complete binary file format specification for Spectre storage files","source":"@site/docs/architecture/block-format.md","sourceDirName":"architecture","slug":"/architecture/block-format","permalink":"/spectre/docs/architecture/block-format","draft":false,"unlisted":false,"editUrl":"https://github.com/moolen/spectre/tree/master/docs/docs/architecture/block-format.md","tags":[],"version":"current","lastUpdatedBy":"Moritz Johner","lastUpdatedAt":1765616329000,"frontMatter":{"title":"Block Format Reference","description":"Complete binary file format specification for Spectre storage files","keywords":["architecture","binary format","file structure","specification"]},"sidebar":"docsSidebar","previous":{"title":"Storage Design","permalink":"/spectre/docs/architecture/storage-design"},"next":{"title":"Indexing Strategy","permalink":"/spectre/docs/architecture/indexing-strategy"}}');var s=i(4848),t=i(8453);const d={title:"Block Format Reference",description:"Complete binary file format specification for Spectre storage files",keywords:["architecture","binary format","file structure","specification"]},l="Block Format Reference",c={},o=[{value:"Format Overview",id:"format-overview",level:2},{value:"Magic Bytes",id:"magic-bytes",level:3},{value:"File Structure",id:"file-structure",level:3},{value:"File Header (77 bytes)",id:"file-header-77-bytes",level:2},{value:"Header Layout",id:"header-layout",level:3},{value:"Reading the Header",id:"reading-the-header",level:3},{value:"Default Header Values",id:"default-header-values",level:3},{value:"Block Data Section",id:"block-data-section",level:2},{value:"Block Structure",id:"block-structure",level:3},{value:"Event Encoding (Protobuf)",id:"event-encoding-protobuf",level:3},{value:"Compression",id:"compression",level:3},{value:"Index Section (JSON)",id:"index-section-json",level:2},{value:"Index Structure",id:"index-structure",level:3},{value:"Block Metadata Fields",id:"block-metadata-fields",level:3},{value:"Bloom Filter Configuration",id:"bloom-filter-configuration",level:3},{value:"Inverted Indexes",id:"inverted-indexes",level:3},{value:"Final Resource States",id:"final-resource-states",level:3},{value:"File Footer (324 bytes)",id:"file-footer-324-bytes",level:2},{value:"Footer Layout",id:"footer-layout",level:3},{value:"Reading the Footer",id:"reading-the-footer",level:3},{value:"File Validation",id:"file-validation",level:2},{value:"Integrity Checks",id:"integrity-checks",level:3},{value:"Crash Detection",id:"crash-detection",level:3},{value:"Version Compatibility",id:"version-compatibility",level:2},{value:"Version Support Matrix",id:"version-support-matrix",level:3},{value:"Version Validation",id:"version-validation",level:3},{value:"Future Versions",id:"future-versions",level:3},{value:"Complete Example: Reading a File",id:"complete-example-reading-a-file",level:2},{value:"Performance Considerations",id:"performance-considerations",level:2},{value:"File Size Estimates",id:"file-size-estimates",level:3},{value:"Read Performance",id:"read-performance",level:3},{value:"Write Performance",id:"write-performance",level:3},{value:"Related Documentation",id:"related-documentation",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"block-format-reference",children:"Block Format Reference"})}),"\n",(0,s.jsx)(n.p,{children:"This document provides a complete specification of Spectre's binary storage file format. The format is designed for append-only writes, efficient compression, and fast query access through indexing."}),"\n",(0,s.jsx)(n.h2,{id:"format-overview",children:"Format Overview"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Current Version:"})," 1.0\n",(0,s.jsx)(n.strong,{children:"File Extension:"})," ",(0,s.jsx)(n.code,{children:".bin"}),"\n",(0,s.jsx)(n.strong,{children:"Encoding:"})," Little-endian binary\n",(0,s.jsx)(n.strong,{children:"Compression:"})," gzip (level 6 - DefaultCompression)\n",(0,s.jsx)(n.strong,{children:"Event Encoding:"})," Protobuf with length-prefixed messages"]}),"\n",(0,s.jsx)(n.h3,{id:"magic-bytes",children:"Magic Bytes"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Header Magic:"})," ",(0,s.jsx)(n.code,{children:"RPKBLOCK"})," (8 bytes ASCII)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Footer Magic:"})," ",(0,s.jsx)(n.code,{children:"RPKEND"})," (8 bytes ASCII)"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"These magic bytes enable file type identification and integrity validation."}),"\n",(0,s.jsx)(n.h3,{id:"file-structure",children:"File Structure"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        File Header (77 bytes)                   \u2502\n\u2502  Magic: RPKBLOCK | Version: 1.0 | Compression: gzip | ...       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         Block 0 (variable)                       \u2502\n\u2502              Compressed Protobuf Event Stream                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         Block 1 (variable)                       \u2502\n\u2502              Compressed Protobuf Event Stream                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              ...\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         Block N (variable)                       \u2502\n\u2502              Compressed Protobuf Event Stream                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Index Section (JSON, variable)                \u2502\n\u2502  BlockMetadata | InvertedIndexes | Statistics | States          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      File Footer (324 bytes)                     \u2502\n\u2502  IndexOffset | IndexLength | Checksum | Magic: RPKEND           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(n.h2,{id:"file-header-77-bytes",children:"File Header (77 bytes)"}),"\n",(0,s.jsx)(n.p,{children:"The header contains metadata required to read and validate the file format."}),"\n",(0,s.jsx)(n.h3,{id:"header-layout",children:"Header Layout"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Offset"}),(0,s.jsx)(n.th,{children:"Length"}),(0,s.jsx)(n.th,{children:"Field"}),(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"0"}),(0,s.jsx)(n.td,{children:"8"}),(0,s.jsx)(n.td,{children:"MagicBytes"}),(0,s.jsx)(n.td,{children:"ASCII"}),(0,s.jsx)(n.td,{children:'Must be "RPKBLOCK"'})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"8"}),(0,s.jsx)(n.td,{children:"8"}),(0,s.jsx)(n.td,{children:"FormatVersion"}),(0,s.jsx)(n.td,{children:"ASCII"}),(0,s.jsx)(n.td,{children:'Version string (e.g., "1.0"), null-padded'})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"16"}),(0,s.jsx)(n.td,{children:"8"}),(0,s.jsx)(n.td,{children:"CreatedAt"}),(0,s.jsx)(n.td,{children:"int64"}),(0,s.jsx)(n.td,{children:"Unix timestamp in nanoseconds"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"24"}),(0,s.jsx)(n.td,{children:"16"}),(0,s.jsx)(n.td,{children:"CompressionAlgorithm"}),(0,s.jsx)(n.td,{children:"ASCII"}),(0,s.jsx)(n.td,{children:'"gzip" or "zstd", null-padded'})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"40"}),(0,s.jsx)(n.td,{children:"4"}),(0,s.jsx)(n.td,{children:"BlockSize"}),(0,s.jsx)(n.td,{children:"int32"}),(0,s.jsx)(n.td,{children:"Target uncompressed block size in bytes"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"44"}),(0,s.jsx)(n.td,{children:"16"}),(0,s.jsx)(n.td,{children:"EncodingFormat"}),(0,s.jsx)(n.td,{children:"ASCII"}),(0,s.jsx)(n.td,{children:'"protobuf" or "json", null-padded'})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"60"}),(0,s.jsx)(n.td,{children:"1"}),(0,s.jsx)(n.td,{children:"ChecksumEnabled"}),(0,s.jsx)(n.td,{children:"byte"}),(0,s.jsx)(n.td,{children:"0 = disabled, 1 = enabled"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"61"}),(0,s.jsx)(n.td,{children:"16"}),(0,s.jsx)(n.td,{children:"Reserved"}),(0,s.jsx)(n.td,{children:"bytes"}),(0,s.jsx)(n.td,{children:"Reserved for future use (zeros)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"77"})}),(0,s.jsx)(n.td,{children:"-"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Total"})}),(0,s.jsx)(n.td,{children:"-"}),(0,s.jsx)(n.td,{children:"Fixed header size"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"reading-the-header",children:"Reading the Header"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'// Read file header\nfile.Seek(0, io.SeekStart)\nheaderBytes := make([]byte, 77)\nfile.Read(headerBytes)\n\n// Parse magic bytes\nmagic := string(headerBytes[0:8])\nif magic != "RPKBLOCK" {\n    return fmt.Errorf("invalid file format")\n}\n\n// Parse version\nversion := string(bytes.TrimRight(headerBytes[8:16], "\\x00"))\n\n// Parse created timestamp\ncreatedAt := int64(binary.LittleEndian.Uint64(headerBytes[16:24]))\n\n// Parse compression algorithm\ncompression := string(bytes.TrimRight(headerBytes[24:40], "\\x00"))\n\n// Parse block size\nblockSize := int32(binary.LittleEndian.Uint32(headerBytes[40:44]))\n\n// Parse encoding format\nencoding := string(bytes.TrimRight(headerBytes[44:60], "\\x00"))\n\n// Parse checksum flag\nchecksumEnabled := headerBytes[60] != 0\n'})}),"\n",(0,s.jsx)(n.h3,{id:"default-header-values",children:"Default Header Values"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'MagicBytes:           "RPKBLOCK"\nFormatVersion:        "1.0"\nCreatedAt:            time.Now().UnixNano()\nCompressionAlgorithm: "gzip"      // Note: "zstd" defined but not implemented\nBlockSize:            262144      // 256KB (default constant in code)\nEncodingFormat:       "protobuf"\nChecksumEnabled:      false\n'})}),"\n",(0,s.jsx)(n.h2,{id:"block-data-section",children:"Block Data Section"}),"\n",(0,s.jsx)(n.p,{children:"Blocks are written sequentially after the file header. Each block contains compressed event data."}),"\n",(0,s.jsx)(n.h3,{id:"block-structure",children:"Block Structure"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:"type Block struct {\n    ID                 int32   // Sequential block number (0-based)\n    Offset             int64   // Byte offset in file\n    Length             int64   // Compressed data length\n    UncompressedLength int64   // Uncompressed data length\n    EventCount         int32   // Number of events\n    TimestampMin       int64   // Minimum event timestamp (nanoseconds)\n    TimestampMax       int64   // Maximum event timestamp (nanoseconds)\n    CompressedData     []byte  // gzip-compressed protobuf stream\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"event-encoding-protobuf",children:"Event Encoding (Protobuf)"}),"\n",(0,s.jsx)(n.p,{children:"Events within a block are encoded as length-prefixed protobuf messages:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 varint len  \u2502 protobuf msg \u2502 varint len  \u2502 protobuf msg \u2502 ...\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Encoding Process:"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Unmarshal Event from JSON to Go struct"}),"\n",(0,s.jsx)(n.li,{children:"Marshal Event to protobuf bytes"}),"\n",(0,s.jsxs)(n.li,{children:["Write varint-encoded length (using ",(0,s.jsx)(n.code,{children:"binary.PutUvarint"}),")"]}),"\n",(0,s.jsx)(n.li,{children:"Write protobuf bytes"}),"\n",(0,s.jsx)(n.li,{children:"Repeat for all events in block"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Decoding Process:"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Read varint-encoded length"}),"\n",(0,s.jsx)(n.li,{children:"Read protobuf bytes of that length"}),"\n",(0,s.jsx)(n.li,{children:"Unmarshal protobuf to Event struct"}),"\n",(0,s.jsx)(n.li,{children:"Repeat until end of decompressed data"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"compression",children:"Compression"}),"\n",(0,s.jsxs)(n.p,{children:["Each block's protobuf stream is compressed using ",(0,s.jsx)(n.strong,{children:"gzip"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Library:"})," ",(0,s.jsx)(n.code,{children:"github.com/klauspost/compress/gzip"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Compression Level:"})," ",(0,s.jsx)(n.code,{children:"gzip.DefaultCompression"})," (level 6)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Typical Ratio:"})," 0.20-0.30 (70-80% reduction)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Effectiveness Check:"})," Compression must achieve at least 10% reduction (ratio < 0.9)"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"index-section-json",children:"Index Section (JSON)"}),"\n",(0,s.jsx)(n.p,{children:"The index section is a JSON-encoded structure written after all blocks, before the footer. It contains metadata for fast query execution."}),"\n",(0,s.jsx)(n.h3,{id:"index-structure",children:"Index Structure"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "format_version": "1.0",\n  "block_metadata": [\n    {\n      "id": 0,\n      "offset": 77,\n      "compressed_length": 65432,\n      "uncompressed_length": 262144,\n      "event_count": 200,\n      "timestamp_min": 1733915200000000000,\n      "timestamp_max": 1733915259999999999,\n      "kind_set": ["Pod", "Deployment", "Service"],\n      "namespace_set": ["default", "kube-system"],\n      "group_set": ["apps", ""],\n      "bloom_filter_kinds": {\n        "serialized_bitset": "base64-encoded-bloom-filter",\n        "false_positive_rate": 0.05,\n        "expected_elements": 1000,\n        "hash_functions": 4\n      },\n      "bloom_filter_namespaces": { ... },\n      "bloom_filter_groups": { ... },\n      "checksum": ""\n    }\n  ],\n  "inverted_indexes": {\n    "kind_to_blocks": {\n      "Pod": [0, 1, 3, 7],\n      "Deployment": [0, 2, 5],\n      "Service": [0, 4, 6]\n    },\n    "namespace_to_blocks": {\n      "default": [0, 1, 2],\n      "kube-system": [3, 4, 5]\n    },\n    "group_to_blocks": {\n      "": [0, 1],\n      "apps": [2, 3],\n      "batch": [4]\n    }\n  },\n  "statistics": {\n    "total_blocks": 300,\n    "total_events": 60000,\n    "total_uncompressed_bytes": 78643200,\n    "total_compressed_bytes": 19660800,\n    "compression_ratio": 0.25,\n    "unique_kinds": 15,\n    "unique_namespaces": 8,\n    "unique_groups": 6,\n    "timestamp_min": 1733915200000000000,\n    "timestamp_max": 1733918799999999999\n  },\n  "final_resource_states": {\n    "apps/v1/Deployment/default/nginx": {\n      "uid": "abc123",\n      "event_type": "UPDATE",\n      "timestamp": 1733918799999999999,\n      "resource_data": { ... }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"block-metadata-fields",children:"Block Metadata Fields"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Field"}),(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"id"})}),(0,s.jsx)(n.td,{children:"int32"}),(0,s.jsx)(n.td,{children:"Block ID (0-based sequential)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"offset"})}),(0,s.jsx)(n.td,{children:"int64"}),(0,s.jsx)(n.td,{children:"Byte offset in file where block starts"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"compressed_length"})}),(0,s.jsx)(n.td,{children:"int64"}),(0,s.jsx)(n.td,{children:"Size of compressed data in bytes"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"uncompressed_length"})}),(0,s.jsx)(n.td,{children:"int64"}),(0,s.jsx)(n.td,{children:"Size before compression"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"event_count"})}),(0,s.jsx)(n.td,{children:"int32"}),(0,s.jsx)(n.td,{children:"Number of events in block"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"timestamp_min"})}),(0,s.jsx)(n.td,{children:"int64"}),(0,s.jsx)(n.td,{children:"Minimum event timestamp (nanoseconds)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"timestamp_max"})}),(0,s.jsx)(n.td,{children:"int64"}),(0,s.jsx)(n.td,{children:"Maximum event timestamp (nanoseconds)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"kind_set"})}),(0,s.jsx)(n.td,{children:"[]string"}),(0,s.jsx)(n.td,{children:"Unique resource kinds in block"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"namespace_set"})}),(0,s.jsx)(n.td,{children:"[]string"}),(0,s.jsx)(n.td,{children:"Unique namespaces in block"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"group_set"})}),(0,s.jsx)(n.td,{children:"[]string"}),(0,s.jsx)(n.td,{children:"Unique API groups in block"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"bloom_filter_kinds"})}),(0,s.jsx)(n.td,{children:"BloomFilter"}),(0,s.jsx)(n.td,{children:"Probabilistic kind filter (5% FP rate)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"bloom_filter_namespaces"})}),(0,s.jsx)(n.td,{children:"BloomFilter"}),(0,s.jsx)(n.td,{children:"Probabilistic namespace filter (5% FP rate)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"bloom_filter_groups"})}),(0,s.jsx)(n.td,{children:"BloomFilter"}),(0,s.jsx)(n.td,{children:"Probabilistic group filter (5% FP rate)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"checksum"})}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{children:"CRC32 hex if enabled, empty otherwise"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"bloom-filter-configuration",children:"Bloom Filter Configuration"}),"\n",(0,s.jsx)(n.p,{children:"Each block has three Bloom filters for efficient filtering:"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Filter Type"}),(0,s.jsx)(n.th,{children:"Expected Elements"}),(0,s.jsx)(n.th,{children:"False Positive Rate"}),(0,s.jsx)(n.th,{children:"Purpose"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Kinds"}),(0,s.jsx)(n.td,{children:"1000"}),(0,s.jsx)(n.td,{children:"0.05 (5%)"}),(0,s.jsx)(n.td,{children:"Filter by resource kind"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Namespaces"}),(0,s.jsx)(n.td,{children:"100"}),(0,s.jsx)(n.td,{children:"0.05 (5%)"}),(0,s.jsx)(n.td,{children:"Filter by namespace"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Groups"}),(0,s.jsx)(n.td,{children:"100"}),(0,s.jsx)(n.td,{children:"0.05 (5%)"}),(0,s.jsx)(n.td,{children:"Filter by API group"})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Combined False Positive Rate:"})," ~14.3% when using all three filters together (1 - (1 - 0.05)\xb3)"]}),"\n",(0,s.jsx)(n.h3,{id:"inverted-indexes",children:"Inverted Indexes"}),"\n",(0,s.jsx)(n.p,{children:"The inverted indexes map resource attribute values to block IDs for fast filtering:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:"type InvertedIndex struct {\n    KindToBlocks      map[string][]int32  // kind \u2192 block IDs\n    NamespaceToBlocks map[string][]int32  // namespace \u2192 block IDs\n    GroupToBlocks     map[string][]int32  // group \u2192 block IDs\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Query Optimization:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Query: ",(0,s.jsx)(n.code,{children:"kind=Pod AND namespace=default"})]}),"\n",(0,s.jsxs)(n.li,{children:["Lookup: ",(0,s.jsx)(n.code,{children:'kind_to_blocks["Pod"] = [0, 1, 3, 7]'})]}),"\n",(0,s.jsxs)(n.li,{children:["Lookup: ",(0,s.jsx)(n.code,{children:'namespace_to_blocks["default"] = [0, 1, 2]'})]}),"\n",(0,s.jsxs)(n.li,{children:["Intersection: ",(0,s.jsx)(n.code,{children:"[0, 1, 3, 7] \u2229 [0, 1, 2] = [0, 1]"})]}),"\n",(0,s.jsx)(n.li,{children:"Result: Only blocks 0 and 1 need to be decompressed"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"final-resource-states",children:"Final Resource States"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"final_resource_states"})," map preserves the last known state of each resource at the time the file was closed. This enables consistent resource views across hourly file boundaries."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Key Format:"})," ",(0,s.jsx)(n.code,{children:"group/version/kind/namespace/name"}),"\n",(0,s.jsx)(n.strong,{children:"Example:"})," ",(0,s.jsx)(n.code,{children:"apps/v1/Deployment/default/nginx"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:"type ResourceLastState struct {\n    UID          string          // Resource UID\n    EventType    string          // CREATE, UPDATE, or DELETE\n    Timestamp    int64           // Last observed timestamp\n    ResourceData json.RawMessage // Full resource object (null for DELETE)\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"file-footer-324-bytes",children:"File Footer (324 bytes)"}),"\n",(0,s.jsx)(n.p,{children:"The footer enables backward seeking to locate the index section and validates file integrity."}),"\n",(0,s.jsx)(n.h3,{id:"footer-layout",children:"Footer Layout"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Offset"}),(0,s.jsx)(n.th,{children:"Length"}),(0,s.jsx)(n.th,{children:"Field"}),(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"0"}),(0,s.jsx)(n.td,{children:"8"}),(0,s.jsx)(n.td,{children:"IndexSectionOffset"}),(0,s.jsx)(n.td,{children:"int64"}),(0,s.jsx)(n.td,{children:"Byte offset where index section starts"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"8"}),(0,s.jsx)(n.td,{children:"4"}),(0,s.jsx)(n.td,{children:"IndexSectionLength"}),(0,s.jsx)(n.td,{children:"int32"}),(0,s.jsx)(n.td,{children:"Byte length of index section"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"12"}),(0,s.jsx)(n.td,{children:"256"}),(0,s.jsx)(n.td,{children:"Checksum"}),(0,s.jsx)(n.td,{children:"ASCII"}),(0,s.jsx)(n.td,{children:"CRC32 hash (hex), null-padded if unused"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"268"}),(0,s.jsx)(n.td,{children:"48"}),(0,s.jsx)(n.td,{children:"Reserved"}),(0,s.jsx)(n.td,{children:"bytes"}),(0,s.jsx)(n.td,{children:"Reserved for future use (zeros)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"316"}),(0,s.jsx)(n.td,{children:"8"}),(0,s.jsx)(n.td,{children:"MagicBytes"}),(0,s.jsx)(n.td,{children:"ASCII"}),(0,s.jsx)(n.td,{children:'Must be "RPKEND"'})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"324"})}),(0,s.jsx)(n.td,{children:"-"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Total"})}),(0,s.jsx)(n.td,{children:"-"}),(0,s.jsx)(n.td,{children:"Fixed footer size"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"reading-the-footer",children:"Reading the Footer"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'// Seek to footer (324 bytes from end)\nfile.Seek(-324, io.SeekEnd)\nfooterBytes := make([]byte, 324)\nfile.Read(footerBytes)\n\n// Verify magic bytes\nmagic := string(bytes.TrimRight(footerBytes[316:324], "\\x00"))\nif magic != "RPKEND" {\n    return fmt.Errorf("invalid or incomplete file")\n}\n\n// Parse index offset and length\nindexOffset := int64(binary.LittleEndian.Uint64(footerBytes[0:8]))\nindexLength := int32(binary.LittleEndian.Uint32(footerBytes[8:12]))\n\n// Parse checksum (optional)\nchecksum := string(bytes.TrimRight(footerBytes[12:268], "\\x00"))\n\n// Read index section\nfile.Seek(indexOffset, io.SeekStart)\nindexBytes := make([]byte, indexLength)\nfile.Read(indexBytes)\n\n// Parse JSON index\nvar index IndexSection\njson.Unmarshal(indexBytes, &index)\n'})}),"\n",(0,s.jsx)(n.h2,{id:"file-validation",children:"File Validation"}),"\n",(0,s.jsx)(n.h3,{id:"integrity-checks",children:"Integrity Checks"}),"\n",(0,s.jsx)(n.p,{children:"When opening a file, perform these validation steps:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Header Magic Bytes:"})," Verify ",(0,s.jsx)(n.code,{children:'MagicBytes == "RPKBLOCK"'})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Format Version:"})," Verify version is supported (currently only ",(0,s.jsx)(n.code,{children:"1.0"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Footer Magic Bytes:"})," Verify ",(0,s.jsx)(n.code,{children:'MagicBytes == "RPKEND"'})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Index Offset:"})," Verify offset is within file bounds"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Index Length:"})," Verify length is reasonable (not negative, not larger than file)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Block Checksums:"})," Verify each block's CRC32 if checksums enabled"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"crash-detection",children:"Crash Detection"}),"\n",(0,s.jsx)(n.p,{children:"If the footer is missing or invalid:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["File is ",(0,s.jsx)(n.strong,{children:"incomplete"})," (crashed during write)"]}),"\n",(0,s.jsxs)(n.li,{children:["Rename to ",(0,s.jsx)(n.code,{children:".incomplete.<timestamp>"})]}),"\n",(0,s.jsx)(n.li,{children:"Create new empty file"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"If the header is invalid:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["File is ",(0,s.jsx)(n.strong,{children:"corrupted"})]}),"\n",(0,s.jsxs)(n.li,{children:["Rename to ",(0,s.jsx)(n.code,{children:".corrupted.<timestamp>"})]}),"\n",(0,s.jsx)(n.li,{children:"Create new empty file"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"version-compatibility",children:"Version Compatibility"}),"\n",(0,s.jsx)(n.h3,{id:"version-support-matrix",children:"Version Support Matrix"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Reader Version"}),(0,s.jsx)(n.th,{children:"File Version"}),(0,s.jsx)(n.th,{children:"Compatible?"}),(0,s.jsx)(n.th,{children:"Notes"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"1.0"}),(0,s.jsx)(n.td,{children:"1.0"}),(0,s.jsx)(n.td,{children:"\u2705 Yes"}),(0,s.jsx)(n.td,{children:"Full support"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"1.0"}),(0,s.jsx)(n.td,{children:"1.1"}),(0,s.jsx)(n.td,{children:"\u26a0\ufe0f Partial"}),(0,s.jsx)(n.td,{children:"Forward compatible (minor version)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"1.0"}),(0,s.jsx)(n.td,{children:"2.0"}),(0,s.jsx)(n.td,{children:"\u274c No"}),(0,s.jsx)(n.td,{children:"Major version mismatch"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"version-validation",children:"Version Validation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'func ValidateVersion(version string) error {\n    // Version format: "major.minor"\n    parts := strings.Split(version, ".")\n    if len(parts) != 2 {\n        return fmt.Errorf("invalid version format: %s", version)\n    }\n\n    major := parts[0]\n\n    // Support all 1.x versions (forward compatible within major version)\n    if major == "1" {\n        return nil\n    }\n\n    return fmt.Errorf("unsupported major version: %s", major)\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"future-versions",children:"Future Versions"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Version 1.1"})," (Planned):"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Enhanced metadata tracking"}),"\n",(0,s.jsx)(n.li,{children:"Optional JSON encoding support"}),"\n",(0,s.jsx)(n.li,{children:"Improved Bloom filter configurations"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Version 2.0"})," (Planned):"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Full zstd compression support"}),"\n",(0,s.jsx)(n.li,{children:"Variable-length block sizes"}),"\n",(0,s.jsx)(n.li,{children:"Dictionary learning for better compression"}),"\n",(0,s.jsx)(n.li,{children:"Distributed query optimizations"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"complete-example-reading-a-file",children:"Complete Example: Reading a File"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n    "encoding/binary"\n    "encoding/json"\n    "fmt"\n    "io"\n    "os"\n)\n\nfunc ReadStorageFile(filename string) error {\n    file, err := os.Open(filename)\n    if err != nil {\n        return err\n    }\n    defer file.Close()\n\n    // 1. Read and validate header\n    file.Seek(0, io.SeekStart)\n    headerBytes := make([]byte, 77)\n    if _, err := file.Read(headerBytes); err != nil {\n        return fmt.Errorf("failed to read header: %w", err)\n    }\n\n    magic := string(headerBytes[0:8])\n    if magic != "RPKBLOCK" {\n        return fmt.Errorf("invalid file format: %s", magic)\n    }\n\n    version := string(bytes.TrimRight(headerBytes[8:16], "\\x00"))\n    compression := string(bytes.TrimRight(headerBytes[24:40], "\\x00"))\n    fmt.Printf("File version: %s, compression: %s\\n", version, compression)\n\n    // 2. Read and validate footer\n    file.Seek(-324, io.SeekEnd)\n    footerBytes := make([]byte, 324)\n    if _, err := file.Read(footerBytes); err != nil {\n        return fmt.Errorf("failed to read footer: %w", err)\n    }\n\n    footerMagic := string(bytes.TrimRight(footerBytes[316:324], "\\x00"))\n    if footerMagic != "RPKEND" {\n        return fmt.Errorf("incomplete or corrupted file")\n    }\n\n    // 3. Read index section\n    indexOffset := int64(binary.LittleEndian.Uint64(footerBytes[0:8]))\n    indexLength := int32(binary.LittleEndian.Uint32(footerBytes[8:12]))\n\n    file.Seek(indexOffset, io.SeekStart)\n    indexBytes := make([]byte, indexLength)\n    if _, err := file.Read(indexBytes); err != nil {\n        return fmt.Errorf("failed to read index: %w", err)\n    }\n\n    var index IndexSection\n    if err := json.Unmarshal(indexBytes, &index); err != nil {\n        return fmt.Errorf("failed to parse index: %w", err)\n    }\n\n    fmt.Printf("Total blocks: %d, total events: %d\\n",\n        index.Statistics.TotalBlocks, index.Statistics.TotalEvents)\n\n    // 4. Query specific block\n    blockMeta := index.BlockMetadata[5]\n    file.Seek(blockMeta.Offset, io.SeekStart)\n    compressedData := make([]byte, blockMeta.CompressedLength)\n    if _, err := file.Read(compressedData); err != nil {\n        return fmt.Errorf("failed to read block: %w", err)\n    }\n\n    // 5. Decompress and parse events\n    events, err := DecompressAndParseBlock(compressedData)\n    if err != nil {\n        return fmt.Errorf("failed to decompress block: %w", err)\n    }\n\n    fmt.Printf("Block 5 contains %d events\\n", len(events))\n\n    return nil\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"performance-considerations",children:"Performance Considerations"}),"\n",(0,s.jsx)(n.h3,{id:"file-size-estimates",children:"File Size Estimates"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Component"}),(0,s.jsx)(n.th,{children:"Size"}),(0,s.jsx)(n.th,{children:"Percentage"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"File Header"}),(0,s.jsx)(n.td,{children:"77 bytes"}),(0,s.jsx)(n.td,{children:"<0.001%"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Compressed Events"}),(0,s.jsx)(n.td,{children:"15-25 MB/hour (typical)"}),(0,s.jsx)(n.td,{children:"~95%"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Index Metadata"}),(0,s.jsx)(n.td,{children:"500 KB - 2 MB/hour"}),(0,s.jsx)(n.td,{children:"~3-5%"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Bloom Filters"}),(0,s.jsx)(n.td,{children:"100-200 KB/hour"}),(0,s.jsx)(n.td,{children:"~1%"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"File Footer"}),(0,s.jsx)(n.td,{children:"324 bytes"}),(0,s.jsx)(n.td,{children:"<0.001%"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"read-performance",children:"Read Performance"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Header read:"})," O(1) - 77 bytes"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Footer read:"})," O(1) - 324 bytes from end"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Index read:"})," O(N) where N = index size (typically <2 MB)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Block read:"})," O(1) seek + O(M) decompress where M = block size"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"write-performance",children:"Write Performance"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Event buffering:"})," O(1) per event"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Block finalization:"})," O(N) where N = events in block (protobuf encode + gzip compress)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Index write:"})," O(M) where M = total blocks (build inverted indexes)"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/spectre/docs/architecture/storage-design",children:"Storage Design"})," - Architecture and design decisions"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/spectre/docs/architecture/indexing-strategy",children:"Indexing Strategy"})," - Query optimization techniques"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/spectre/docs/architecture/compression",children:"Compression"})," - Compression algorithms and performance"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/spectre/docs/configuration/storage-settings",children:"Storage Settings"})," - Configuration guide"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>d,x:()=>l});var r=i(6540);const s={},t=r.createContext(s);function d(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:d(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);