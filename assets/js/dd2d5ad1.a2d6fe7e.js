"use strict";(globalThis.webpackChunkspectre_docs=globalThis.webpackChunkspectre_docs||[]).push([[3862],{3798:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"use-cases/incident-investigation","title":"Incident Investigation","description":"Step-by-step guide for investigating Kubernetes incidents with Spectre","source":"@site/docs/use-cases/incident-investigation.md","sourceDirName":"use-cases","slug":"/use-cases/incident-investigation","permalink":"/spectre/docs/use-cases/incident-investigation","draft":false,"unlisted":false,"editUrl":"https://github.com/moolen/spectre/tree/master/docs/docs/use-cases/incident-investigation.md","tags":[],"version":"current","lastUpdatedBy":"Moritz Johner","lastUpdatedAt":1765616329000,"frontMatter":{"title":"Incident Investigation","description":"Step-by-step guide for investigating Kubernetes incidents with Spectre","keywords":["incident","investigation","troubleshooting","kubernetes","root cause","timeline"]},"sidebar":"docsSidebar","previous":{"title":"Use Cases","permalink":"/spectre/docs/use-cases/"},"next":{"title":"Post-Mortem Analysis","permalink":"/spectre/docs/use-cases/post-mortem-analysis"}}');var r=i(4848),t=i(8453);const o={title:"Incident Investigation",description:"Step-by-step guide for investigating Kubernetes incidents with Spectre",keywords:["incident","investigation","troubleshooting","kubernetes","root cause","timeline"]},l="Incident Investigation",c={},d=[{value:"Overview",id:"overview",level:2},{value:"Common Incident Scenarios",id:"common-incident-scenarios",level:2},{value:"Scenario 1: Pods Failing (CrashLoopBackOff)",id:"scenario-1-pods-failing-crashloopbackoff",level:3},{value:"Step 1: Identify Affected Resources",id:"step-1-identify-affected-resources",level:4},{value:"Step 2: Find the Deployment",id:"step-2-find-the-deployment",level:4},{value:"Step 3: Identify What Changed",id:"step-3-identify-what-changed",level:4},{value:"Step 4: Check Related Resources",id:"step-4-check-related-resources",level:4},{value:"Step 5: Review Pod Events",id:"step-5-review-pod-events",level:4},{value:"Step 6: Determine Root Cause",id:"step-6-determine-root-cause",level:4},{value:"Step 7: Take Action",id:"step-7-take-action",level:4},{value:"Scenario 2: Service Unavailable",id:"scenario-2-service-unavailable",level:3},{value:"Investigation Steps",id:"investigation-steps",level:4},{value:"Scenario 3: Deployment Stuck",id:"scenario-3-deployment-stuck",level:3},{value:"Investigation Steps",id:"investigation-steps-1",level:4},{value:"Using MCP for Faster Investigation",id:"using-mcp-for-faster-investigation",level:2},{value:"Natural Language Investigation",id:"natural-language-investigation",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"\u2705 Do",id:"-do",level:3},{value:"\u274c Don&#39;t",id:"-dont",level:3},{value:"Query Examples",id:"query-examples",level:2},{value:"Find Recent Failures",id:"find-recent-failures",level:3},{value:"Track Deployment Timeline",id:"track-deployment-timeline",level:3},{value:"Find Config Changes",id:"find-config-changes",level:3},{value:"All Events for Resource",id:"all-events-for-resource",level:3},{value:"Cross-Namespace Issues",id:"cross-namespace-issues",level:3},{value:"Troubleshooting Tips",id:"troubleshooting-tips",level:2},{value:"Empty Results",id:"empty-results",level:3},{value:"Too Many Results",id:"too-many-results",level:3},{value:"Correlation Confusion",id:"correlation-confusion",level:3},{value:"Integration with Monitoring",id:"integration-with-monitoring",level:2},{value:"Prometheus AlertManager",id:"prometheus-alertmanager",level:3},{value:"PagerDuty",id:"pagerduty",level:3},{value:"Related Documentation",id:"related-documentation",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"incident-investigation",children:"Incident Investigation"})}),"\n",(0,r.jsx)(n.p,{children:"Quick and effective incident investigation using Spectre's event tracking and timeline reconstruction capabilities."}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(n.p,{children:"When an incident occurs, time is critical. Spectre helps you quickly identify:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"What changed"})," - Recent deployments, config updates, or resource modifications"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"When it failed"})," - Exact timestamps of state transitions and errors"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Why it failed"})," - Event messages and status changes that reveal root cause"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"What's affected"})," - All related resources impacted by the incident"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Time to resolution"}),": Typically 5-15 minutes faster than manual investigation through kubectl and logs."]}),"\n",(0,r.jsx)(n.h2,{id:"common-incident-scenarios",children:"Common Incident Scenarios"}),"\n",(0,r.jsx)(n.h3,{id:"scenario-1-pods-failing-crashloopbackoff",children:"Scenario 1: Pods Failing (CrashLoopBackOff)"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptoms"}),": Alert fires indicating pods are in CrashLoopBackOff state."]}),"\n",(0,r.jsx)(n.h4,{id:"step-1-identify-affected-resources",children:"Step 1: Identify Affected Resources"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Query Spectre"})," for recent pod events:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Query: kind:Pod,status:Error,namespace:production\nTime range: Last 30 minutes\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"UI"}),": Navigate to Spectre UI \u2192 Enter query \u2192 View timeline"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"API"})," (programmatic):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"START=$(date -d '30 minutes ago' +%s)\nEND=$(date +%s)\n\ncurl \"http://spectre:8080/api/search?query=kind:Pod,status:Error,namespace:production&start=$START&end=$END\" | jq .\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Expected output"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "events": [\n    {\n      "timestamp": "2024-12-12T10:05:45Z",\n      "kind": "Pod",\n      "name": "api-server-85f6c9b8-k4x2p",\n      "namespace": "production",\n      "status": "Error",\n      "message": "Back-off restarting failed container",\n      "count": 15\n    }\n  ]\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"step-2-find-the-deployment",children:"Step 2: Find the Deployment"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Query parent Deployment"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Query: kind:Deployment,namespace:production\nFilter: Related to failing pods (check ownerReferences)\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Timeline view"})," shows deployment events before pod failures."]}),"\n",(0,r.jsx)(n.h4,{id:"step-3-identify-what-changed",children:"Step 3: Identify What Changed"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Query recent changes"})," to the deployment:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Query: kind:Deployment,name:api-server,namespace:production\nTime range: 1 hour ago to now\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Look for"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Image updates"}),"\n",(0,r.jsx)(n.li,{children:"ConfigMap or Secret references changed"}),"\n",(0,r.jsx)(n.li,{children:"Resource limit adjustments"}),"\n",(0,r.jsx)(n.li,{children:"Replica count changes"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Example finding"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"[10:04:12] Deployment updated: image v1.2.0 \u2192 v1.3.0\n[10:05:45] Pods started failing (2 minutes later)\n"})}),"\n",(0,r.jsx)(n.h4,{id:"step-4-check-related-resources",children:"Step 4: Check Related Resources"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Query ConfigMaps and Secrets"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Query: kind:ConfigMap,namespace:production\nOr: kind:Secret,namespace:production\nTime range: 1 hour ago to now\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Common root causes revealed"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"ConfigMap deleted \u2192 pods can't start"}),"\n",(0,r.jsx)(n.li,{children:"Secret expired \u2192 authentication failures"}),"\n",(0,r.jsx)(n.li,{children:"ConfigMap updated incorrectly \u2192 missing required keys"}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"step-5-review-pod-events",children:"Step 5: Review Pod Events"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Query Kubernetes events for the pod"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Query: involvedObject:api-server-85f6c9b8-k4x2p\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Critical event messages"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:'"Back-off restarting failed container" \u2192 Container crash'}),"\n",(0,r.jsx)(n.li,{children:'"Failed to pull image" \u2192 Registry issues'}),"\n",(0,r.jsx)(n.li,{children:'"Error: configmap not found" \u2192 Missing config'}),"\n",(0,r.jsx)(n.li,{children:'"OOMKilled" \u2192 Memory limit exceeded'}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"step-6-determine-root-cause",children:"Step 6: Determine Root Cause"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Correlate timeline"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"What changed (deployment, config)?"}),"\n",(0,r.jsx)(n.li,{children:"When did failures start?"}),"\n",(0,r.jsx)(n.li,{children:"What error messages appear?"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Example correlation"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'[10:04:00] ConfigMap/api-config updated (added DATABASE_URL)\n[10:04:12] Deployment updated (references api-config)\n[10:04:45] Pods failing with "environment variable DATABASE_URL not set"\n\nRoot cause: ConfigMap update added DATABASE_URL, but deployment\ntemplate doesn\'t mount it as environment variable.\n'})}),"\n",(0,r.jsx)(n.h4,{id:"step-7-take-action",children:"Step 7: Take Action"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Immediate mitigation"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Option 1: Rollback deployment\nkubectl rollout undo deployment/api-server -n production\n\n# Option 2: Fix configuration\nkubectl set env deployment/api-server DATABASE_URL=\"$(kubectl get configmap api-config -n production -o jsonpath='{.data.DATABASE_URL}')\"\n\n# Option 3: Fix ConfigMap\nkubectl edit configmap api-config -n production\n# Remove DATABASE_URL or fix deployment\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Verify recovery"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Watch pods recover\nkubectl get pods -n production -w\n\n# Query Spectre for new events\n# Should see pods transitioning to Running state\n"})}),"\n",(0,r.jsx)(n.h3,{id:"scenario-2-service-unavailable",children:"Scenario 2: Service Unavailable"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptoms"}),": Service returns 503 errors, no endpoints available."]}),"\n",(0,r.jsx)(n.h4,{id:"investigation-steps",children:"Investigation Steps"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"1. Check Service events"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Query: kind:Service,name:api-server,namespace:production\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"2. Find related Endpoint events"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Query: kind:Endpoints,name:api-server,namespace:production\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Expected finding"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"[10:05:00] Endpoints removed (0 ready pods)\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"3. Investigate why pods aren't ready"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Query: kind:Pod,namespace:production,label:app=api-server\nStatus filter: Not Ready\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Common causes"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Readiness probe failing"}),"\n",(0,r.jsx)(n.li,{children:"Pods stuck in CrashLoopBackOff"}),"\n",(0,r.jsx)(n.li,{children:"Pods in ImagePullBackOff"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"4. Check probe configuration"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl get deployment api-server -o yaml | grep -A5 readinessProbe\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"5. Review pod logs"})," (Spectre shows events, kubectl shows logs):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl logs <pod-name> -n production\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"6. Correlate with Spectre timeline"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"When did endpoints disappear?"}),"\n",(0,r.jsx)(n.li,{children:"What changed before that?"}),"\n",(0,r.jsx)(n.li,{children:"Are there deployment or config events?"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"scenario-3-deployment-stuck",children:"Scenario 3: Deployment Stuck"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptoms"}),": Deployment rollout not progressing, old and new pods coexist."]}),"\n",(0,r.jsx)(n.h4,{id:"investigation-steps-1",children:"Investigation Steps"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"1. Query Deployment events"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Query: kind:Deployment,name:api-server,namespace:production\nStatus: Warning or Error\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"2. Check ReplicaSet events"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Query: kind:ReplicaSet,namespace:production,label:app=api-server\nTime range: Last hour\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"3. Identify stuck pods"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Query: kind:Pod,namespace:production,status:Pending\nOr: kind:Pod,namespace:production,status:ContainerCreating\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Common reasons"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Insufficient resources (CPU/memory)"}),"\n",(0,r.jsx)(n.li,{children:"ImagePullBackOff on new version"}),"\n",(0,r.jsx)(n.li,{children:"PVC mount failures"}),"\n",(0,r.jsx)(n.li,{children:"Node selector not matching"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"4. Check resource quota"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Query: kind:ResourceQuota,namespace:production\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Event message might show"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'"Failed to create pod: exceeded quota"\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"5. Check Node events"})," (if resource constraints):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Query: kind:Node\nStatus: Warnings related to capacity\n"})}),"\n",(0,r.jsx)(n.h2,{id:"using-mcp-for-faster-investigation",children:"Using MCP for Faster Investigation"}),"\n",(0,r.jsx)(n.h3,{id:"natural-language-investigation",children:"Natural Language Investigation"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"With Claude Desktop + MCP"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'You: Pods are failing in production namespace. Investigate.\n\nClaude: [Automatically queries Spectre via MCP]\nI found 3 pods in Error state (CrashLoopBackOff).\nThe deployment was updated 10 minutes ago.\n\nTimeline:\n[10:04:12] Deployment updated: image v1.2\u2192v1.3\n[10:05:45] Pods started failing\n[10:06:00] Event: "Failed to pull image v1.3"\n\nRoot cause: Image v1.3 doesn\'t exist in registry or\nauthentication is failing.\n\nImmediate fix:\nkubectl rollout undo deployment/api-server -n production\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"MCP benefits"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Automatic event correlation"}),"\n",(0,r.jsx)(n.li,{children:"Natural language queries"}),"\n",(0,r.jsx)(n.li,{children:"Suggested remediation steps"}),"\n",(0,r.jsx)(n.li,{children:"No need to remember query syntax"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Learn more"}),": ",(0,r.jsx)(n.a,{href:"/spectre/docs/mcp-integration/",children:"MCP Integration Guide"})]}),"\n",(0,r.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsx)(n.h3,{id:"-do",children:"\u2705 Do"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Start broad, then narrow"}),": Query all pods in namespace first, then drill down to specific resources"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Check timelines visually"}),": Use Spectre UI timeline view to see event correlation"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Query related resources"}),": Check ConfigMaps, Secrets, and Services referenced by failing pods"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Look for patterns"}),": Multiple pods failing at once suggests deployment or config issue"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Verify with kubectl"}),": Confirm Spectre findings with ",(0,r.jsx)(n.code,{children:"kubectl describe"})," and ",(0,r.jsx)(n.code,{children:"kubectl logs"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Document findings"}),": Export Spectre timeline for incident reports"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"-dont",children:"\u274c Don't"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Don't ignore time windows"}),": Narrow time ranges to incident period for faster queries"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Don't skip config resources"}),": ConfigMap/Secret changes often cause pod failures"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Don't forget node events"}),": Node issues can cause cluster-wide pod failures"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Don't rely only on Spectre"}),": Use ",(0,r.jsx)(n.code,{children:"kubectl logs"})," for application error details"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Don't ignore recurring patterns"}),": Repeated failures at specific times indicate systemic issues"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"query-examples",children:"Query Examples"}),"\n",(0,r.jsx)(n.h3,{id:"find-recent-failures",children:"Find Recent Failures"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Query: status:Error\nTime range: Last 1 hour\nNamespace: production\n"})}),"\n",(0,r.jsx)(n.h3,{id:"track-deployment-timeline",children:"Track Deployment Timeline"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Query: kind:Deployment,name:api-server\nTime range: 2 hours ago to now\n"})}),"\n",(0,r.jsx)(n.h3,{id:"find-config-changes",children:"Find Config Changes"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Query: kind:ConfigMap OR kind:Secret\nTime range: Last 4 hours\nNamespace: production\n"})}),"\n",(0,r.jsx)(n.h3,{id:"all-events-for-resource",children:"All Events for Resource"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Query: name:api-server-85f6c9b8-k4x2p\nTime range: All available\n"})}),"\n",(0,r.jsx)(n.h3,{id:"cross-namespace-issues",children:"Cross-Namespace Issues"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Query: kind:Node,status:Warning\nTime range: Last 30 minutes\n"})}),"\n",(0,r.jsx)(n.h2,{id:"troubleshooting-tips",children:"Troubleshooting Tips"}),"\n",(0,r.jsx)(n.h3,{id:"empty-results",children:"Empty Results"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Problem"}),": Query returns no events"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Possible causes"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Time window doesn't overlap with event occurrence"}),"\n",(0,r.jsx)(n.li,{children:"Namespace filter too restrictive"}),"\n",(0,r.jsx)(n.li,{children:"Resource kind or name misspelled"}),"\n",(0,r.jsx)(n.li,{children:"Spectre hasn't indexed events yet (check watcher is running)"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Check Spectre is indexing\nkubectl logs -n spectre-system deployment/spectre | grep "indexed"\n\n# Widen time window\n# Remove namespace filter\n# Check exact resource name with kubectl\n'})}),"\n",(0,r.jsx)(n.h3,{id:"too-many-results",children:"Too Many Results"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Problem"}),": Query returns thousands of events"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Narrow time window"}),"\n",(0,r.jsx)(n.li,{children:"Add namespace filter"}),"\n",(0,r.jsx)(n.li,{children:"Filter by status (Error, Warning only)"}),"\n",(0,r.jsx)(n.li,{children:"Use specific resource names"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"correlation-confusion",children:"Correlation Confusion"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Problem"}),": Can't identify which event caused the issue"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Sort by timestamp in UI"}),"\n",(0,r.jsx)(n.li,{children:"Look for status transitions (Ready \u2192 Error)"}),"\n",(0,r.jsx)(n.li,{children:"Check for events 1-5 minutes before failures"}),"\n",(0,r.jsx)(n.li,{children:"Focus on Deployment, ConfigMap, Secret changes"}),"\n",(0,r.jsx)(n.li,{children:"Use MCP for automatic correlation"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"integration-with-monitoring",children:"Integration with Monitoring"}),"\n",(0,r.jsx)(n.h3,{id:"prometheus-alertmanager",children:"Prometheus AlertManager"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Workflow"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Alert fires with timestamp"}),"\n",(0,r.jsx)(n.li,{children:"Runbook includes Spectre query link"}),"\n",(0,r.jsx)(n.li,{children:"Query Spectre for events \xb115 minutes around alert time"}),"\n",(0,r.jsx)(n.li,{children:"Correlate metric spike with Kubernetes events"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Example runbook entry"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Runbook: High Pod Restart Rate\n\n1. Check metrics: <grafana-link>\n2. Check events: http://spectre/search?query=kind:Pod,namespace:production&start={{alert_time-15m}}&end={{alert_time+15m}}\n3. Look for: Deployment updates, ConfigMap changes, OOMKilled events\n"})}),"\n",(0,r.jsx)(n.h3,{id:"pagerduty",children:"PagerDuty"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Workflow"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"PagerDuty alert includes namespace and resource"}),"\n",(0,r.jsx)(n.li,{children:"Operator queries Spectre with alert details"}),"\n",(0,r.jsx)(n.li,{children:"Timeline reveals root cause"}),"\n",(0,r.jsx)(n.li,{children:"Resolution time documented in PagerDuty"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Example alert enrichment"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "incident_key": "prod-pod-failures",\n  "description": "3 pods failing in production",\n  "details": {\n    "namespace": "production",\n    "deployment": "api-server",\n    "spectre_query": "kind:Pod,namespace:production,status:Error"\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/spectre/docs/use-cases/post-mortem-analysis",children:"Post-Mortem Analysis"})," - Document incidents after resolution"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/spectre/docs/use-cases/deployment-tracking",children:"Deployment Tracking"})," - Monitor rollouts proactively"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/spectre/docs/mcp-integration/",children:"MCP Integration"})," - AI-assisted investigations"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/spectre/docs/user-guide/querying-events",children:"User Guide"})," - Master Spectre query syntax"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>l});var s=i(6540);const r={},t=s.createContext(r);function o(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);