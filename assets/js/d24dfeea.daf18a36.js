"use strict";(globalThis.webpackChunkspectre_docs=globalThis.webpackChunkspectre_docs||[]).push([[3808],{1779:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>l,default:()=>a,frontMatter:()=>d,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"architecture/compression","title":"Compression","description":"Compression algorithms and performance characteristics","source":"@site/docs/architecture/compression.md","sourceDirName":"architecture","slug":"/architecture/compression","permalink":"/spectre/docs/architecture/compression","draft":false,"unlisted":false,"editUrl":"https://github.com/moolen/spectre/tree/master/docs/docs/architecture/compression.md","tags":[],"version":"current","lastUpdatedBy":"Moritz Johner","lastUpdatedAt":1765616329000,"frontMatter":{"title":"Compression","description":"Compression algorithms and performance characteristics","keywords":["architecture","compression","gzip","zstd","performance"]},"sidebar":"docsSidebar","previous":{"title":"Indexing Strategy","permalink":"/spectre/docs/architecture/indexing-strategy"},"next":{"title":"Query Execution","permalink":"/spectre/docs/architecture/query-execution"}}');var i=n(4848),t=n(8453);const d={title:"Compression",description:"Compression algorithms and performance characteristics",keywords:["architecture","compression","gzip","zstd","performance"]},l="Compression",c={},o=[{value:"Overview",id:"overview",level:2},{value:"Current Implementation: gzip",id:"current-implementation-gzip",level:2},{value:"Library and Configuration",id:"library-and-configuration",level:3},{value:"Implementation Details",id:"implementation-details",level:3},{value:"Compression Ratios",id:"compression-ratios",level:3},{value:"Block Size Impact on Compression",id:"block-size-impact-on-compression",level:3},{value:"Performance Characteristics",id:"performance-characteristics",level:2},{value:"Compression Speed",id:"compression-speed",level:3},{value:"Decompression Speed",id:"decompression-speed",level:3},{value:"Compression Effectiveness Check",id:"compression-effectiveness-check",level:3},{value:"Compression Levels Comparison",id:"compression-levels-comparison",level:2},{value:"Future: zstd Compression",id:"future-zstd-compression",level:2},{value:"Planned for Version 2.0",id:"planned-for-version-20",level:3},{value:"Performance Comparison",id:"performance-comparison",level:3},{value:"Migration Strategy",id:"migration-strategy",level:3},{value:"Space Savings Examples",id:"space-savings-examples",level:2},{value:"Small Cluster (100 resources)",id:"small-cluster-100-resources",level:3},{value:"Medium Cluster (1000 resources)",id:"medium-cluster-1000-resources",level:3},{value:"Large Cluster (10,000+ resources)",id:"large-cluster-10000-resources",level:3},{value:"Compression Alternatives (Not Used)",id:"compression-alternatives-not-used",level:2},{value:"Why Not Snappy?",id:"why-not-snappy",level:3},{value:"Why Not LZ4?",id:"why-not-lz4",level:3},{value:"Why Not Brotli?",id:"why-not-brotli",level:3},{value:"Compression Metrics and Monitoring",id:"compression-metrics-and-monitoring",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"\u2705 Do",id:"-do",level:3},{value:"\u274c Don&#39;t",id:"-dont",level:3},{value:"Related Documentation",id:"related-documentation",level:2}];function h(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"compression",children:"Compression"})}),"\n",(0,i.jsx)(s.p,{children:"This document explains Spectre's compression strategy for efficient storage of Kubernetes audit events."}),"\n",(0,i.jsx)(s.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(s.p,{children:["Compression is applied at the ",(0,i.jsx)(s.strong,{children:"block level"})," after events are buffered and encoded as protobuf:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"Events (JSON)\n    \u2193\nProtobuf Encoding\n    \u2193\ngzip Compression (level 6)\n    \u2193\nWrite to Disk\n"})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Key Benefits:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"75% storage reduction"})," (typical compression ratio: 0.25)"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Fast decompression"})," (~300 MB/s throughput)"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Block-level granularity"})," (only decompress blocks needed for query)"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"current-implementation-gzip",children:"Current Implementation: gzip"}),"\n",(0,i.jsx)(s.h3,{id:"library-and-configuration",children:"Library and Configuration"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Library:"})," ",(0,i.jsx)(s.code,{children:"github.com/klauspost/compress/gzip"})]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Optimized Go implementation (2-3x faster than standard library)"}),"\n",(0,i.jsx)(s.li,{children:"Full compatibility with standard gzip format"}),"\n",(0,i.jsx)(s.li,{children:"Supports streaming compression/decompression"}),"\n"]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Compression Level:"})," ",(0,i.jsx)(s.code,{children:"gzip.DefaultCompression"})," (level 6)"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Range: 0 (no compression) to 9 (best compression)"}),"\n",(0,i.jsx)(s.li,{children:"Level 6 balances compression ratio and speed"}),"\n",(0,i.jsx)(s.li,{children:"Higher levels provide diminishing returns"}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"implementation-details",children:"Implementation Details"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-go",children:"// Compress block data\nfunc (c *Compressor) Compress(data []byte) ([]byte, error) {\n    var buf bytes.Buffer\n\n    // Create gzip writer with default compression\n    writer, err := gzip.NewWriterLevel(&buf, gzip.DefaultCompression)\n    if err != nil {\n        return nil, err\n    }\n\n    // Write data\n    writer.Write(data)\n    writer.Close()\n\n    return buf.Bytes(), nil\n}\n"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-go",children:"// Decompress block data\nfunc (c *Compressor) Decompress(data []byte) ([]byte, error) {\n    reader, err := gzip.NewReader(bytes.NewReader(data))\n    if err != nil {\n        return nil, err\n    }\n    defer reader.Close()\n\n    return io.ReadAll(reader)\n}\n"})}),"\n",(0,i.jsx)(s.h3,{id:"compression-ratios",children:"Compression Ratios"}),"\n",(0,i.jsx)(s.p,{children:"Typical compression ratios for different data types:"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Data Type"}),(0,i.jsx)(s.th,{children:"Raw Size"}),(0,i.jsx)(s.th,{children:"Compressed"}),(0,i.jsx)(s.th,{children:"Ratio"}),(0,i.jsx)(s.th,{children:"Reduction"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Kubernetes JSON events"}),(0,i.jsx)(s.td,{children:"100 MB"}),(0,i.jsx)(s.td,{children:"25 MB"}),(0,i.jsx)(s.td,{children:"0.25"}),(0,i.jsx)(s.td,{children:"75%"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Protobuf events"}),(0,i.jsx)(s.td,{children:"80 MB"}),(0,i.jsx)(s.td,{children:"24 MB"}),(0,i.jsx)(s.td,{children:"0.30"}),(0,i.jsx)(s.td,{children:"70%"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Mixed workload"}),(0,i.jsx)(s.td,{children:"100 MB"}),(0,i.jsx)(s.td,{children:"20-30 MB"}),(0,i.jsx)(s.td,{children:"0.20-0.30"}),(0,i.jsx)(s.td,{children:"70-80%"})]})]})]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Why JSON events compress well:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Repetitive structure (field names repeated across events)"}),"\n",(0,i.jsx)(s.li,{children:"Common values (namespaces, kinds, groups)"}),"\n",(0,i.jsx)(s.li,{children:"Predictable patterns (timestamps, UIDs, labels)"}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"block-size-impact-on-compression",children:"Block Size Impact on Compression"}),"\n",(0,i.jsx)(s.p,{children:"Larger blocks compress better due to more context for the compression algorithm:"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Block Size"}),(0,i.jsx)(s.th,{children:"Events"}),(0,i.jsx)(s.th,{children:"Uncompressed"}),(0,i.jsx)(s.th,{children:"Compressed"}),(0,i.jsx)(s.th,{children:"Ratio"}),(0,i.jsx)(s.th,{children:"Reduction"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"1 MB"}),(0,i.jsx)(s.td,{children:"~80"}),(0,i.jsx)(s.td,{children:"1 MB"}),(0,i.jsx)(s.td,{children:"350 KB"}),(0,i.jsx)(s.td,{children:"0.35"}),(0,i.jsx)(s.td,{children:"65%"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"10 MB"}),(0,i.jsx)(s.td,{children:"~800"}),(0,i.jsx)(s.td,{children:"10 MB"}),(0,i.jsx)(s.td,{children:"2.5 MB"}),(0,i.jsx)(s.td,{children:"0.25"}),(0,i.jsx)(s.td,{children:"75%"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"100 MB"}),(0,i.jsx)(s.td,{children:"~8000"}),(0,i.jsx)(s.td,{children:"100 MB"}),(0,i.jsx)(s.td,{children:"22 MB"}),(0,i.jsx)(s.td,{children:"0.22"}),(0,i.jsx)(s.td,{children:"78%"})]})]})]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Diminishing Returns:"})," Beyond 10 MB, compression ratio improvements are minimal (<5%)"]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Default Choice:"})," 10 MB blocks provide good compression (75%) without excessive decompression latency"]}),"\n",(0,i.jsx)(s.h2,{id:"performance-characteristics",children:"Performance Characteristics"}),"\n",(0,i.jsx)(s.h3,{id:"compression-speed",children:"Compression Speed"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Metric"}),(0,i.jsx)(s.th,{children:"Value"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.strong,{children:"Throughput"})}),(0,i.jsx)(s.td,{children:"~100 MB/s"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.strong,{children:"CPU Utilization"})}),(0,i.jsx)(s.td,{children:"~10% of single core"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.strong,{children:"Latency (10 MB)"})}),(0,i.jsx)(s.td,{children:"~100 ms"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.strong,{children:"Memory Overhead"})}),(0,i.jsx)(s.td,{children:"~2\xd7 block size"})]})]})]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Typical Workflow:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"10 MB block \u2192 100 ms compression \u2192 2.5 MB written to disk\n"})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Amortization:"})," Compression latency is hidden by buffering (only triggered when block is full)"]}),"\n",(0,i.jsx)(s.h3,{id:"decompression-speed",children:"Decompression Speed"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Metric"}),(0,i.jsx)(s.th,{children:"Value"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.strong,{children:"Throughput"})}),(0,i.jsx)(s.td,{children:"~300 MB/s"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.strong,{children:"CPU Utilization"})}),(0,i.jsx)(s.td,{children:"~5% of single core"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.strong,{children:"Latency (10 MB)"})}),(0,i.jsx)(s.td,{children:"~30 ms"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.strong,{children:"Memory Overhead"})}),(0,i.jsx)(s.td,{children:"~block size"})]})]})]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"3\xd7 faster than compression"})," (typical for gzip)"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Query Impact:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"Query reads 8 blocks:\n  8 blocks \xd7 2.5 MB compressed = 20 MB disk I/O\n  8 blocks \xd7 10 MB uncompressed = 80 MB decompressed\n  8 blocks \xd7 30 ms = 240 ms total decompression latency\n"})}),"\n",(0,i.jsx)(s.h3,{id:"compression-effectiveness-check",children:"Compression Effectiveness Check"}),"\n",(0,i.jsxs)(s.p,{children:["Spectre validates that compression provides at least ",(0,i.jsx)(s.strong,{children:"10% reduction"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-go",children:"func (c *Compressor) IsCompressionEffective(original, compressed []byte) bool {\n    if len(original) == 0 {\n        return false\n    }\n    ratio := float64(len(compressed)) / float64(len(original))\n    return ratio < 0.9  // More than 10% reduction\n}\n"})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Use Case:"})," Detect incompressible data (e.g., already compressed, encrypted, random)"]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Fallback:"})," If compression is ineffective, could store uncompressed (not currently implemented)"]}),"\n",(0,i.jsx)(s.h2,{id:"compression-levels-comparison",children:"Compression Levels Comparison"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Level"}),(0,i.jsx)(s.th,{children:"Ratio"}),(0,i.jsx)(s.th,{children:"Compression Speed"}),(0,i.jsx)(s.th,{children:"Decompression Speed"}),(0,i.jsx)(s.th,{children:"Best For"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"1"}),(0,i.jsx)(s.td,{children:"0.40"}),(0,i.jsx)(s.td,{children:"200 MB/s"}),(0,i.jsx)(s.td,{children:"300 MB/s"}),(0,i.jsx)(s.td,{children:"CPU-constrained"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"6*"}),(0,i.jsx)(s.td,{children:"0.25"}),(0,i.jsx)(s.td,{children:"100 MB/s"}),(0,i.jsx)(s.td,{children:"300 MB/s"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.strong,{children:"Balanced (default)"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"9"}),(0,i.jsx)(s.td,{children:"0.23"}),(0,i.jsx)(s.td,{children:"20 MB/s"}),(0,i.jsx)(s.td,{children:"300 MB/s"}),(0,i.jsx)(s.td,{children:"Storage-constrained"})]})]})]}),"\n",(0,i.jsx)(s.p,{children:"*Level 6 = DefaultCompression"}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Why Default Level 6:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Good compression ratio (75% reduction)"}),"\n",(0,i.jsx)(s.li,{children:"Fast enough for real-time writes (~100 ms for 10 MB)"}),"\n",(0,i.jsx)(s.li,{children:"Decompression speed unaffected by compression level"}),"\n",(0,i.jsx)(s.li,{children:"Best balance for typical workloads"}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"future-zstd-compression",children:"Future: zstd Compression"}),"\n",(0,i.jsx)(s.h3,{id:"planned-for-version-20",children:"Planned for Version 2.0"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Library:"})," Zstandard (Facebook)"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Newer compression algorithm (2016)"}),"\n",(0,i.jsx)(s.li,{children:"Better compression ratio than gzip"}),"\n",(0,i.jsx)(s.li,{children:"Faster compression and decompression"}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"performance-comparison",children:"Performance Comparison"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Metric"}),(0,i.jsx)(s.th,{children:"gzip (level 6)"}),(0,i.jsx)(s.th,{children:"zstd (level 3)"}),(0,i.jsx)(s.th,{children:"Improvement"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.strong,{children:"Compression Ratio"})}),(0,i.jsx)(s.td,{children:"0.25"}),(0,i.jsx)(s.td,{children:"0.22"}),(0,i.jsx)(s.td,{children:"+12% better"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.strong,{children:"Compression Speed"})}),(0,i.jsx)(s.td,{children:"100 MB/s"}),(0,i.jsx)(s.td,{children:"200 MB/s"}),(0,i.jsx)(s.td,{children:"2\xd7 faster"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.strong,{children:"Decompression Speed"})}),(0,i.jsx)(s.td,{children:"300 MB/s"}),(0,i.jsx)(s.td,{children:"450 MB/s"}),(0,i.jsx)(s.td,{children:"1.5\xd7 faster"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.strong,{children:"CPU Usage"})}),(0,i.jsx)(s.td,{children:"10%"}),(0,i.jsx)(s.td,{children:"8%"}),(0,i.jsx)(s.td,{children:"20% less"})]})]})]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"For 10 MB block:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"gzip: 100 ms compression, 30 ms decompression"}),"\n",(0,i.jsx)(s.li,{children:"zstd: 50 ms compression, 20 ms decompression"}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Total savings:"})," 60 ms per block"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"For query reading 8 blocks:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"gzip: 240 ms decompression"}),"\n",(0,i.jsx)(s.li,{children:"zstd: 160 ms decompression"}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Savings:"})," 80 ms (33% faster)"]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"migration-strategy",children:"Migration Strategy"}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Challenges:"})}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Backward compatibility:"})," Existing files use gzip"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Mixed formats:"})," Need to support both gzip and zstd during transition"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Tooling:"})," External tools must support zstd"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Proposed Approach:"})}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Opt-in flag:"})," ",(0,i.jsx)(s.code,{children:"--compression=zstd"})," (default: gzip)"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Format detection:"})," Read ",(0,i.jsx)(s.code,{children:"CompressionAlgorithm"})," from file header"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Recompression tool:"})," Convert gzip files to zstd offline"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Documentation:"})," Guide users through migration"]}),"\n"]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Timeline:"})," Planned for Spectre 2.0 (Q2 2026)"]}),"\n",(0,i.jsx)(s.h2,{id:"space-savings-examples",children:"Space Savings Examples"}),"\n",(0,i.jsx)(s.h3,{id:"small-cluster-100-resources",children:"Small Cluster (100 resources)"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Event Rate:"})," 10 events/minute\n",(0,i.jsx)(s.strong,{children:"Hourly Events:"})," 600\n",(0,i.jsx)(s.strong,{children:"Average Event Size:"})," 12 KB"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"Raw size:     600 events \xd7 12 KB = 7.2 MB/hour\nCompressed:   7.2 MB \xd7 0.25 = 1.8 MB/hour\nDaily:        1.8 MB \xd7 24 = 43 MB/day\nWeekly:       43 MB \xd7 7 = 301 MB/week\nMonthly:      43 MB \xd7 30 = 1.3 GB/month\n"})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Savings vs no compression:"})," 21.6 GB/month saved (94.4% less disk usage)"]}),"\n",(0,i.jsx)(s.h3,{id:"medium-cluster-1000-resources",children:"Medium Cluster (1000 resources)"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Event Rate:"})," 100 events/minute\n",(0,i.jsx)(s.strong,{children:"Hourly Events:"})," 6,000"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"Raw size:     6,000 events \xd7 12 KB = 72 MB/hour\nCompressed:   72 MB \xd7 0.25 = 18 MB/hour\nDaily:        18 MB \xd7 24 = 432 MB/day\nWeekly:       432 MB \xd7 7 = 3 GB/week\nMonthly:      432 MB \xd7 30 = 13 GB/month\n"})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Savings vs no compression:"})," 216 GB/month saved"]}),"\n",(0,i.jsx)(s.h3,{id:"large-cluster-10000-resources",children:"Large Cluster (10,000+ resources)"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Event Rate:"})," 1000 events/minute\n",(0,i.jsx)(s.strong,{children:"Hourly Events:"})," 60,000"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"Raw size:     60,000 events \xd7 12 KB = 720 MB/hour\nCompressed:   720 MB \xd7 0.25 = 180 MB/hour\nDaily:        180 MB \xd7 24 = 4.3 GB/day\nWeekly:       4.3 GB \xd7 7 = 30 GB/week\nMonthly:      4.3 GB \xd7 30 = 130 GB/month\n"})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Savings vs no compression:"})," 2.16 TB/month saved"]}),"\n",(0,i.jsx)(s.h2,{id:"compression-alternatives-not-used",children:"Compression Alternatives (Not Used)"}),"\n",(0,i.jsx)(s.h3,{id:"why-not-snappy",children:"Why Not Snappy?"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Aspect"}),(0,i.jsx)(s.th,{children:"Snappy"}),(0,i.jsx)(s.th,{children:"gzip"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Compression Ratio"}),(0,i.jsx)(s.td,{children:"0.50 (50% reduction)"}),(0,i.jsx)(s.td,{children:"0.25 (75% reduction)"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Compression Speed"}),(0,i.jsx)(s.td,{children:"500 MB/s"}),(0,i.jsx)(s.td,{children:"100 MB/s"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Decompression Speed"}),(0,i.jsx)(s.td,{children:"1500 MB/s"}),(0,i.jsx)(s.td,{children:"300 MB/s"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Best For"}),(0,i.jsx)(s.td,{children:"CPU > Disk"}),(0,i.jsx)(s.td,{children:"Disk > CPU"})]})]})]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Decision:"})," Storage cost is more important than CPU cost for audit logs"]}),"\n",(0,i.jsx)(s.h3,{id:"why-not-lz4",children:"Why Not LZ4?"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Aspect"}),(0,i.jsx)(s.th,{children:"LZ4"}),(0,i.jsx)(s.th,{children:"gzip"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Compression Ratio"}),(0,i.jsx)(s.td,{children:"0.45 (55% reduction)"}),(0,i.jsx)(s.td,{children:"0.25 (75% reduction)"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Compression Speed"}),(0,i.jsx)(s.td,{children:"600 MB/s"}),(0,i.jsx)(s.td,{children:"100 MB/s"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Decompression Speed"}),(0,i.jsx)(s.td,{children:"2000 MB/s"}),(0,i.jsx)(s.td,{children:"300 MB/s"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Best For"}),(0,i.jsx)(s.td,{children:"Low-latency reads"}),(0,i.jsx)(s.td,{children:"High compression"})]})]})]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Decision:"})," Audit logs are write-heavy, archival workload; compression ratio more valuable"]}),"\n",(0,i.jsx)(s.h3,{id:"why-not-brotli",children:"Why Not Brotli?"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Aspect"}),(0,i.jsx)(s.th,{children:"Brotli"}),(0,i.jsx)(s.th,{children:"gzip"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Compression Ratio"}),(0,i.jsx)(s.td,{children:"0.20 (80% reduction)"}),(0,i.jsx)(s.td,{children:"0.25 (75% reduction)"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Compression Speed"}),(0,i.jsx)(s.td,{children:"10 MB/s"}),(0,i.jsx)(s.td,{children:"100 MB/s"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Decompression Speed"}),(0,i.jsx)(s.td,{children:"300 MB/s"}),(0,i.jsx)(s.td,{children:"300 MB/s"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Best For"}),(0,i.jsx)(s.td,{children:"Static assets"}),(0,i.jsx)(s.td,{children:"Real-time streams"})]})]})]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Decision:"})," Too slow for real-time event compression (10\xd7 slower than gzip)"]}),"\n",(0,i.jsx)(s.h2,{id:"compression-metrics-and-monitoring",children:"Compression Metrics and Monitoring"}),"\n",(0,i.jsx)(s.p,{children:"Spectre tracks compression effectiveness:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-go",children:"type CompressionMetrics struct {\n    TotalUncompressedBytes int64   // Raw data size\n    TotalCompressedBytes   int64   // After compression\n    CompressionRatio       float32 // Compressed / Uncompressed\n    BlocksCompressed       int64   // Number of blocks processed\n    AverageRatio           float32 // Mean compression ratio\n}\n"})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Available via API:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:'curl http://localhost:8080/api/v1/storage/stats\n\n{\n  "total_uncompressed_bytes": 78643200,\n  "total_compressed_bytes": 19660800,\n  "compression_ratio": 0.25,\n  "blocks_compressed": 300,\n  "average_ratio": 0.25\n}\n'})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Use Cases:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Monitor compression effectiveness"})," (should be ~0.25 for typical workloads)"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Detect incompressible data"})," (ratio > 0.9 indicates problem)"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Capacity planning"})," (estimate storage growth)"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Performance analysis"})," (correlate ratio with query latency)"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsx)(s.h3,{id:"-do",children:"\u2705 Do"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Use default compression level (6)"})," - Best balance for most workloads"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Monitor compression ratios"})," - Alert if ratio > 0.5 (poor compression)"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Increase block size"})," - Larger blocks (10-100 MB) compress better"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Enable caching"})," - Avoid repeated decompression of hot blocks"]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"-dont",children:"\u274c Don't"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Don't disable compression"})," - 4\xd7 disk usage increase"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Don't use level 9"})," - Minimal benefit (2-3% better) with 5\xd7 slower compression"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Don't compress pre-compressed data"})," - Waste of CPU (unlikely in Spectre)"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Don't compress very small blocks"})," - Overhead exceeds benefit (<1 KB blocks)"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"/spectre/docs/architecture/storage-design",children:"Storage Design"})," - Block architecture and write path"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"/spectre/docs/architecture/block-format",children:"Block Format Reference"})," - Compression field in file header"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"/spectre/docs/architecture/query-execution",children:"Query Execution"})," - Decompression in query pipeline"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"/spectre/docs/configuration/storage-settings",children:"Storage Settings"})," - Block size configuration"]}),"\n"]})]})}function a(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>d,x:()=>l});var r=n(6540);const i={},t=r.createContext(i);function d(e){const s=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),r.createElement(t.Provider,{value:s},e.children)}}}]);