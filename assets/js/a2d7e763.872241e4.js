"use strict";(globalThis.webpackChunkspectre_docs=globalThis.webpackChunkspectre_docs||[]).push([[6172],{5597:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>p,frontMatter:()=>o,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"mcp-integration/claude-integration","title":"Claude Desktop Integration","description":"Complete guide to connecting Claude Desktop with Spectre MCP for conversational Kubernetes investigations","source":"@site/docs/mcp-integration/claude-integration.md","sourceDirName":"mcp-integration","slug":"/mcp-integration/claude-integration","permalink":"/spectre/docs/mcp-integration/claude-integration","draft":false,"unlisted":false,"editUrl":"https://github.com/moolen/spectre/tree/master/docs/docs/mcp-integration/claude-integration.md","tags":[],"version":"current","lastUpdatedBy":"Moritz Johner","lastUpdatedAt":1765616329000,"frontMatter":{"title":"Claude Desktop Integration","description":"Complete guide to connecting Claude Desktop with Spectre MCP for conversational Kubernetes investigations","keywords":["claude","claude-desktop","mcp","integration","stdio","configuration","setup"]},"sidebar":"docsSidebar","previous":{"title":"live_incident_handling Prompt","permalink":"/spectre/docs/mcp-integration/prompts-reference/live-incident"},"next":{"title":"MCP Real-World Examples","permalink":"/spectre/docs/mcp-integration/examples"}}');var r=s(4848),i=s(8453);const o={title:"Claude Desktop Integration",description:"Complete guide to connecting Claude Desktop with Spectre MCP for conversational Kubernetes investigations",keywords:["claude","claude-desktop","mcp","integration","stdio","configuration","setup"]},l="Claude Desktop Integration",c={},a=[{value:"What You&#39;ll Achieve",id:"what-youll-achieve",level:2},{value:"Requirements",id:"requirements",level:2},{value:"Architecture: How It Works",id:"architecture-how-it-works",level:2},{value:"Stdio Transport",id:"stdio-transport",level:3},{value:"Setup Path 1: Local MCP Server (Development)",id:"setup-path-1-local-mcp-server-development",level:2},{value:"Step 1: Ensure Spectre is Accessible",id:"step-1-ensure-spectre-is-accessible",level:3},{value:"Step 2: Get Spectre Binary",id:"step-2-get-spectre-binary",level:3},{value:"Step 3: Test MCP Server Manually",id:"step-3-test-mcp-server-manually",level:3},{value:"Step 4: Create Wrapper Script (Recommended)",id:"step-4-create-wrapper-script-recommended",level:3},{value:"Step 5: Configure Claude Desktop",id:"step-5-configure-claude-desktop",level:3},{value:"Step 6: Restart Claude Desktop",id:"step-6-restart-claude-desktop",level:3},{value:"Setup Path 2: Remote Spectre (Production)",id:"setup-path-2-remote-spectre-production",level:2},{value:"When to Use Remote Access",id:"when-to-use-remote-access",level:3},{value:"Option 2A: kubectl port-forward",id:"option-2a-kubectl-port-forward",level:3},{value:"Option 2B: kubectl exec (Sidecar MCP)",id:"option-2b-kubectl-exec-sidecar-mcp",level:3},{value:"Option 2C: HTTP Proxy (Advanced)",id:"option-2c-http-proxy-advanced",level:3},{value:"First Investigation with Claude",id:"first-investigation-with-claude",level:2},{value:"Example 1: Quick Health Check",id:"example-1-quick-health-check",level:3},{value:"Example 2: Investigate Failing Pods",id:"example-2-investigate-failing-pods",level:3},{value:"Example 3: Post-Mortem Analysis",id:"example-3-post-mortem-analysis",level:3},{value:"Conversation Patterns",id:"conversation-patterns",level:2},{value:"Pattern 1: Discovery \u2192 Investigation",id:"pattern-1-discovery--investigation",level:3},{value:"Pattern 2: Direct Deep Dive",id:"pattern-2-direct-deep-dive",level:3},{value:"Pattern 3: Time-Based Analysis",id:"pattern-3-time-based-analysis",level:3},{value:"Pattern 4: Iterative Follow-Up",id:"pattern-4-iterative-follow-up",level:3},{value:"Claude Desktop Configuration Reference",id:"claude-desktop-configuration-reference",level:2},{value:"Config File Schema",id:"config-file-schema",level:3},{value:"Multiple Spectre Instances",id:"multiple-spectre-instances",level:3},{value:"Environment Variables",id:"environment-variables",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Issue: Claude Doesn&#39;t See Spectre Tools",id:"issue-claude-doesnt-see-spectre-tools",level:3},{value:"Issue: Claude Says &quot;Tool Call Failed&quot;",id:"issue-claude-says-tool-call-failed",level:3},{value:"Issue: Logs Show &quot;Failed to Parse JSON-RPC Request&quot;",id:"issue-logs-show-failed-to-parse-json-rpc-request",level:3},{value:"Issue: Port-Forward Keeps Disconnecting",id:"issue-port-forward-keeps-disconnecting",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"\u2705 Do",id:"-do",level:3},{value:"\u274c Don&#39;t",id:"-dont",level:3},{value:"Security Considerations",id:"security-considerations",level:2},{value:"Local Development",id:"local-development",level:3},{value:"Production Access",id:"production-access",level:3},{value:"Example Workflow: Production Incident",id:"example-workflow-production-incident",level:2},{value:"Advanced Configuration",id:"advanced-configuration",level:2},{value:"Custom Wrapper Script with Debugging",id:"custom-wrapper-script-with-debugging",level:3},{value:"Multiple Clusters with Context Selection",id:"multiple-clusters-with-context-selection",level:3},{value:"Integration with Other MCP Servers",id:"integration-with-other-mcp-servers",level:3},{value:"Limitations",id:"limitations",level:2},{value:"What Claude CAN Do with Spectre",id:"what-claude-can-do-with-spectre",level:3},{value:"What Claude CANNOT Do (Yet)",id:"what-claude-cannot-do-yet",level:3},{value:"Bridging the Gap",id:"bridging-the-gap",level:3},{value:"Related Documentation",id:"related-documentation",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"claude-desktop-integration",children:"Claude Desktop Integration"})}),"\n",(0,r.jsx)(n.p,{children:"Transform Kubernetes troubleshooting into natural conversations with AI. This guide shows you how to connect Claude Desktop to Spectre's MCP server for conversational incident investigation."}),"\n",(0,r.jsx)(n.h2,{id:"what-youll-achieve",children:"What You'll Achieve"}),"\n",(0,r.jsx)(n.p,{children:"After completing this setup, you'll be able to:"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Natural Language Investigations"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'You: What\'s wrong with my production namespace?\n\nClaude: [Automatically calls cluster_health and investigate tools]\nI found 3 pods in Error state. The api-server deployment\nhad a failed rollout 15 minutes ago due to missing ConfigMap.\nWould you like me to investigate the deployment timeline?\n\nYou: Yes, and show me what changed before it failed\n\nClaude: [Calls resource_changes tool]\nHere\'s what happened:\n1. [10:05] ConfigMap "api-config" was deleted\n2. [10:06] Deployment triggered rolling update\n3. [10:07] New pods failed with "ConfigMap not found"\n\nI recommend:\n1. Restore the ConfigMap or rollback the deployment\n2. Check kubectl logs for the specific error\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Post-Mortem Analysis"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"You: Analyze the incident from yesterday 10:00 to 11:00 in production namespace\n\nClaude: [Automatically uses post_mortem_incident_analysis prompt]\n[Generates comprehensive report with timeline, root cause, and recommendations]\n"})}),"\n",(0,r.jsx)(n.h2,{id:"requirements",children:"Requirements"}),"\n",(0,r.jsx)(n.p,{children:"Before starting, ensure you have:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Claude Desktop"}),": Download from ",(0,r.jsx)(n.a,{href:"https://claude.ai/download",children:"https://claude.ai/download"})," (macOS, Windows, or Linux)"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Spectre Deployed"}),": MCP-enabled Spectre instance (see ",(0,r.jsx)(n.a,{href:"/spectre/docs/mcp-integration/getting-started",children:"Getting Started"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Network Access"}),": Claude Desktop must reach Spectre (local cluster or port-forward/proxy)"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"File System Access"}),": Permission to edit Claude Desktop config file"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"architecture-how-it-works",children:"Architecture: How It Works"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Claude Desktop Application                      \u2502\n\u2502  - Conversational UI                             \u2502\n\u2502  - Automatic tool selection                      \u2502\n\u2502  - Context-aware investigations                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502 MCP Protocol (stdio)\n                 \u2502 Reads/writes newline-delimited JSON\n                 \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  MCP Server Process (spectre mcp --stdio)       \u2502\n\u2502  - Started by Claude as subprocess               \u2502\n\u2502  - stdin/stdout for MCP messages                 \u2502\n\u2502  - stderr for logs                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502 HTTP API\n                 \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Spectre API Server                              \u2502\n\u2502  - Event storage and querying                    \u2502\n\u2502  - Running in Kubernetes or locally              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,r.jsx)(n.h3,{id:"stdio-transport",children:"Stdio Transport"}),"\n",(0,r.jsxs)(n.p,{children:["Claude Desktop uses ",(0,r.jsx)(n.strong,{children:"stdio transport"})," (not HTTP):"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"stdin"}),": Claude sends JSON-RPC requests as newline-delimited JSON"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"stdout"}),": MCP server responds with JSON-RPC responses (one per line)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"stderr"}),": Logs from MCP server (separate from protocol messages)"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Why stdio?"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Simpler setup (no network ports to manage)"}),"\n",(0,r.jsx)(n.li,{children:"Automatic process lifecycle (Claude starts/stops MCP server)"}),"\n",(0,r.jsx)(n.li,{children:"Secure by default (local subprocess, no network exposure)"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"setup-path-1-local-mcp-server-development",children:"Setup Path 1: Local MCP Server (Development)"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Best for"}),": Local development, kind/minikube clusters, quick testing."]}),"\n",(0,r.jsx)(n.h3,{id:"step-1-ensure-spectre-is-accessible",children:"Step 1: Ensure Spectre is Accessible"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Option A: Local Cluster (kind/minikube)"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Spectre should be accessible at localhost via port-forward\nkubectl port-forward -n spectre-system svc/spectre 8080:8080\n\n# Leave this running in a terminal\n# MCP server will connect to http://localhost:8080\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Option B: Remote Cluster with Port-Forward"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Forward Spectre API to localhost\nkubectl port-forward -n spectre-system svc/spectre 8080:8080\n\n# Leave this running\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Verify Spectre is accessible"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"curl http://localhost:8080/api/search | head -n 5\n# Should return JSON response (not connection refused)\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-2-get-spectre-binary",children:"Step 2: Get Spectre Binary"}),"\n",(0,r.jsxs)(n.p,{children:["You need the ",(0,r.jsx)(n.code,{children:"spectre"})," binary to run the MCP server locally."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Option A: Download from Release"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Download latest release for your platform\ncurl -L https://github.com/moolen/spectre/releases/latest/download/spectre-$(uname -s)-$(uname -m) \\\n  -o /usr/local/bin/spectre\n\nchmod +x /usr/local/bin/spectre\n\n# Verify\nspectre version\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Option B: Build from Source"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"git clone https://github.com/moolen/spectre.git\ncd spectre\nmake build\n\n# Binary is at ./bin/spectre\nsudo cp ./bin/spectre /usr/local/bin/spectre\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Option C: Extract from Container Image"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Pull Spectre image\ndocker pull ghcr.io/moolen/spectre:latest\n\n# Extract binary\ndocker create --name spectre-temp ghcr.io/moolen/spectre:latest\ndocker cp spectre-temp:/spectre /usr/local/bin/spectre\ndocker rm spectre-temp\n\nchmod +x /usr/local/bin/spectre\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-3-test-mcp-server-manually",children:"Step 3: Test MCP Server Manually"}),"\n",(0,r.jsx)(n.p,{children:"Before configuring Claude, verify the MCP server works:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Start MCP server in stdio mode\nspectre mcp \\\n  --api-url=http://localhost:8080 \\\n  --stdio\n\n# You should see:\n# {"jsonrpc":"2.0","method":"initialize",...}\n# (Server is waiting for input on stdin)\n\n# Press Ctrl+C to stop\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"If you see errors"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:'"connection refused to localhost:8080"'}),": Spectre API not accessible (check port-forward)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:'"command not found: spectre"'}),": Binary not in PATH or not executable"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"step-4-create-wrapper-script-recommended",children:"Step 4: Create Wrapper Script (Recommended)"}),"\n",(0,r.jsx)(n.p,{children:"Claude Desktop requires a shell command to start the MCP server. Create a wrapper script for easy configuration and debugging."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Create wrapper script\ncat > /usr/local/bin/spectre-mcp-claude.sh << \'EOF\'\n#!/bin/bash\n\n# Spectre MCP Wrapper for Claude Desktop\n# This script starts the MCP server with proper configuration\n\n# Configuration\nAPI_URL="${SPECTRE_API_URL:-http://localhost:8080}"\nLOG_LEVEL="${SPECTRE_LOG_LEVEL:-info}"\n\n# Optional: Log to file for debugging\n# Uncomment to capture logs (Claude only sees stderr)\n# LOG_FILE="/tmp/spectre-mcp-claude.log"\n# exec 2>> "$LOG_FILE"\n\n# Start MCP server\nexec /usr/local/bin/spectre mcp \\\n  --api-url="$API_URL" \\\n  --stdio \\\n  --log-level="$LOG_LEVEL"\nEOF\n\nchmod +x /usr/local/bin/spectre-mcp-claude.sh\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Test the wrapper"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Test with defaults\n/usr/local/bin/spectre-mcp-claude.sh\n\n# Test with custom API URL\nSPECTRE_API_URL=http://192.168.1.10:8080 /usr/local/bin/spectre-mcp-claude.sh\n\n# Press Ctrl+C to stop\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-5-configure-claude-desktop",children:"Step 5: Configure Claude Desktop"}),"\n",(0,r.jsx)(n.p,{children:"Claude Desktop reads MCP server configuration from a JSON file."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Config file location"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"macOS"}),": ",(0,r.jsx)(n.code,{children:"~/Library/Application Support/Claude/claude_desktop_config.json"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Windows"}),": ",(0,r.jsx)(n.code,{children:"%APPDATA%\\Claude\\claude_desktop_config.json"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Linux"}),": ",(0,r.jsx)(n.code,{children:"~/.config/Claude/claude_desktop_config.json"})]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Create or edit the config file"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "mcpServers": {\n    "spectre": {\n      "command": "/usr/local/bin/spectre-mcp-claude.sh",\n      "args": [],\n      "env": {\n        "SPECTRE_API_URL": "http://localhost:8080",\n        "SPECTRE_LOG_LEVEL": "info"\n      }\n    }\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Configuration fields"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"mcpServers"})}),": Map of MCP server definitions (key is display name)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"command"})}),": Absolute path to executable (wrapper script or binary)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"args"})}),": Command-line arguments (empty if using wrapper script)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"env"})}),": Environment variables passed to subprocess"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Alternative: Direct Binary Configuration"})," (without wrapper script):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "mcpServers": {\n    "spectre": {\n      "command": "/usr/local/bin/spectre",\n      "args": [\n        "mcp",\n        "--api-url=http://localhost:8080",\n        "--stdio",\n        "--log-level=info"\n      ]\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"step-6-restart-claude-desktop",children:"Step 6: Restart Claude Desktop"}),"\n",(0,r.jsx)(n.p,{children:"After editing the config:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Quit Claude Desktop"})," completely (not just close window)"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["macOS: ",(0,r.jsx)(n.code,{children:"Cmd+Q"})," or right-click dock icon \u2192 Quit"]}),"\n",(0,r.jsx)(n.li,{children:"Windows: Right-click system tray \u2192 Exit"}),"\n",(0,r.jsx)(n.li,{children:"Linux: Kill the process or use application menu"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Relaunch Claude Desktop"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Verify MCP Connection"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:'Look for "Spectre" in available tools/extensions'}),"\n",(0,r.jsx)(n.li,{children:'Or start a conversation and ask: "What MCP tools do you have access to?"'}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Expected response"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"I have access to the following Spectre MCP tools:\n- cluster_health: Get cluster overview with resource status\n- resource_changes: Identify high-impact changes\n- investigate: Deep dive into specific resources\n- resource_explorer: Browse and discover resources\n\nI also have access to two prompts:\n- post_mortem_incident_analysis\n- live_incident_handling\n"})}),"\n",(0,r.jsx)(n.h2,{id:"setup-path-2-remote-spectre-production",children:"Setup Path 2: Remote Spectre (Production)"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Best for"}),": Production clusters, remote access, shared Spectre instances."]}),"\n",(0,r.jsx)(n.h3,{id:"when-to-use-remote-access",children:"When to Use Remote Access"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Spectre running in a production Kubernetes cluster"}),"\n",(0,r.jsx)(n.li,{children:"Multiple users sharing one Spectre instance"}),"\n",(0,r.jsx)(n.li,{children:"Claude Desktop running on a different machine than kubectl"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"option-2a-kubectl-port-forward",children:"Option 2A: kubectl port-forward"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Simplest approach"})," for authenticated cluster access:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Forward Spectre API to localhost (keep running)\nkubectl port-forward -n spectre-system svc/spectre 8080:8080\n\n# Configure Claude Desktop to use http://localhost:8080\n# (Same as Setup Path 1, Step 5)\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Advantages"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Uses existing kubectl authentication"}),"\n",(0,r.jsx)(n.li,{children:"No additional network exposure"}),"\n",(0,r.jsx)(n.li,{children:"Works through bastion hosts and VPNs"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Disadvantages"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Port-forward must stay running while using Claude"}),"\n",(0,r.jsx)(n.li,{children:"Connection can be unstable (auto-reconnect not always reliable)"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"option-2b-kubectl-exec-sidecar-mcp",children:"Option 2B: kubectl exec (Sidecar MCP)"}),"\n",(0,r.jsxs)(n.p,{children:["If Spectre has MCP sidecar enabled, you can run MCP server ",(0,r.jsx)(n.strong,{children:"inside the pod"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Create wrapper script that runs MCP in-cluster\ncat > /usr/local/bin/spectre-mcp-kubectl.sh << \'EOF\'\n#!/bin/bash\n\nNAMESPACE="${SPECTRE_NAMESPACE:-spectre-system}"\nPOD=$(kubectl get pods -n "$NAMESPACE" -l app.kubernetes.io/name=spectre -o jsonpath=\'{.items[0].metadata.name}\')\n\nif [ -z "$POD" ]; then\n  echo "Error: No Spectre pod found in namespace $NAMESPACE" >&2\n  exit 1\nfi\n\n# Execute MCP server inside pod (stdio mode)\nexec kubectl exec -n "$NAMESPACE" "$POD" -c spectre -i -- \\\n  /spectre mcp --api-url=http://localhost:8080 --stdio\nEOF\n\nchmod +x /usr/local/bin/spectre-mcp-kubectl.sh\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Claude Desktop config"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "mcpServers": {\n    "spectre": {\n      "command": "/usr/local/bin/spectre-mcp-kubectl.sh",\n      "args": [],\n      "env": {\n        "SPECTRE_NAMESPACE": "spectre-system"\n      }\n    }\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Advantages"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"No port-forward needed"}),"\n",(0,r.jsx)(n.li,{children:"Uses cluster networking directly"}),"\n",(0,r.jsx)(n.li,{children:"More stable than port-forward"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Disadvantages"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Requires kubectl exec permissions"}),"\n",(0,r.jsx)(n.li,{children:"Slightly higher latency"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"option-2c-http-proxy-advanced",children:"Option 2C: HTTP Proxy (Advanced)"}),"\n",(0,r.jsxs)(n.p,{children:["For ",(0,r.jsx)(n.strong,{children:"remote access without kubectl"}),", expose Spectre API via ingress or LoadBalancer:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Expose Spectre API (production only, with authentication!)\n# Option 1: LoadBalancer\nkubectl patch svc spectre -n spectre-system -p \'{"spec":{"type":"LoadBalancer"}}\'\n\n# Option 2: Ingress (with TLS and auth)\n# See MCP Configuration Guide for details\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Claude Desktop config"})," (with remote API):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "mcpServers": {\n    "spectre": {\n      "command": "/usr/local/bin/spectre",\n      "args": [\n        "mcp",\n        "--api-url=https://spectre.example.com",\n        "--stdio"\n      ]\n    }\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u26a0\ufe0f Security Warning"}),": Only expose Spectre API with proper authentication (mTLS, OAuth, API tokens). See ",(0,r.jsx)(n.a,{href:"/spectre/docs/configuration/mcp-configuration",children:"MCP Configuration Guide"})," security section."]}),"\n",(0,r.jsx)(n.h2,{id:"first-investigation-with-claude",children:"First Investigation with Claude"}),"\n",(0,r.jsx)(n.p,{children:"Now that Claude Desktop is connected, let's run some investigations."}),"\n",(0,r.jsx)(n.h3,{id:"example-1-quick-health-check",children:"Example 1: Quick Health Check"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"You"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"What's the current state of my Kubernetes cluster?\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Claude"})," (automatic tool calls):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'[Calling cluster_health tool with start_time: now-1h, end_time: now]\n\nYour cluster has 42 resources tracked. Overall status: Healthy\n\nResources by kind:\n- Pods: 15 total (14 healthy, 1 warning)\n- Deployments: 8 total (all healthy)\n- Services: 10 total (all healthy)\n\nTop issues:\n- Pod "api-cache-7x9k2" in namespace "production" has status Warning\n  (High restart count: 5 restarts in last hour)\n\nWould you like me to investigate the warning pod?\n'})}),"\n",(0,r.jsx)(n.h3,{id:"example-2-investigate-failing-pods",children:"Example 2: Investigate Failing Pods"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"You"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Pods are failing in the production namespace. Can you investigate?\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Claude"})," (automatic tool calls):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'[Calling cluster_health with namespace filter: production]\n\nI found 3 pods in Error state in the production namespace:\n\n1. api-server-85f6c9b8-k4x2p - CrashLoopBackOff\n2. api-server-85f6c9b8-m9n4r - CrashLoopBackOff\n3. api-server-85f6c9b8-p2q7t - CrashLoopBackOff\n\nAll three pods belong to the same Deployment: api-server\n\nLet me investigate the deployment timeline...\n\n[Calling investigate tool for Deployment/production/api-server]\n\nTimeline:\n[10:05:12] Deployment updated - Image changed: v1.2.0 \u2192 v1.3.0\n[10:05:45] Pods started failing - Container startup error\n[10:06:30] Status changed to Warning (ReplicaFailure)\n\nRecent events:\n- "Back-off restarting failed container" (count: 15)\n- "Failed to pull image registry.example.com/api-server:v1.3.0"\n\nRoot Cause Analysis:\nThe deployment updated to a new image (v1.3.0) that cannot be pulled.\nThis is likely a registry authentication issue or the image doesn\'t exist.\n\nImmediate Steps:\n1. Verify image exists: docker pull registry.example.com/api-server:v1.3.0\n2. Check imagePullSecrets: kubectl get pods -n production -o yaml | grep imagePullSecrets\n3. Rollback deployment: kubectl rollout undo deployment/api-server -n production\n\nWould you like me to check what changed before this deployment update?\n'})}),"\n",(0,r.jsx)(n.h3,{id:"example-3-post-mortem-analysis",children:"Example 3: Post-Mortem Analysis"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"You"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Analyze the incident from yesterday 10:00 to 11:00 in production namespace\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Claude"})," (uses post_mortem_incident_analysis prompt):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'[Executing post-mortem analysis prompt with arguments:\n  start_time: 2024-12-11 10:00 UTC\n  end_time: 2024-12-11 11:00 UTC\n  namespace: production]\n\n## Incident Summary\n\nService outage caused by ConfigMap deletion, affecting api-server deployment\nfor 12 minutes. Restored after ConfigMap was recreated.\n\n## Timeline\n\n[10:00:05] ConfigMap/production/api-config - Deleted\n[10:02:18] Deployment/production/api-server - Triggered rolling update\n[10:02:45] Pods started failing - "ConfigMap api-config not found"\n[10:03:00] Service endpoints removed (no ready pods)\n[10:12:30] ConfigMap/production/api-config - Created (restored from backup)\n[10:12:55] Pods became healthy\n[10:13:10] Service endpoints restored\n\n## Root Cause Analysis\n\nPrimary Cause: ConfigMap "api-config" was accidentally deleted\n\nContributing Factors:\n1. No backup or version control for ConfigMaps\n2. Deployment references ConfigMap but has no failure handling\n3. No alerting on ConfigMap deletions\n4. Manual restoration took 12 minutes\n\nEvidence:\n- resource_changes shows ConfigMap deletion at 10:00:05 (impact_score: 0.75)\n- investigate shows pods transitioned Running \u2192 Error at 10:02:45\n- Events: "ConfigMap api-config not found" (count: 24)\n\n## Impact Assessment\n\n- Service downtime: 12 minutes\n- Affected resources: 1 Deployment, 3 Pods, 1 Service\n- User impact: API unavailable (100% error rate)\n\n## Recommendations\n\n1. Store ConfigMaps in version control (GitOps with FluxCD/ArgoCD)\n2. Enable RBAC restrictions on ConfigMap deletion\n3. Add ConfigMap change alerts to monitoring\n4. Implement graceful degradation (default config values)\n5. Document ConfigMap restoration procedure\n\n## Data Gaps & Follow-Up\n\nTo complete the analysis:\n1. Check who deleted the ConfigMap: kubectl logs -n kube-system -l app=kube-apiserver\n2. Review application logs: kubectl logs -n production <pod-name> --previous\n3. Verify monitoring alerts fired: Check Prometheus/Datadog alerts for this timeframe\n'})}),"\n",(0,r.jsx)(n.h2,{id:"conversation-patterns",children:"Conversation Patterns"}),"\n",(0,r.jsx)(n.h3,{id:"pattern-1-discovery--investigation",children:"Pattern 1: Discovery \u2192 Investigation"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Efficient workflow"})," for unknown issues:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"You: Check the production namespace for any issues\n\nClaude: [cluster_health] Found 2 pods in Error state...\n\nYou: Investigate the api-server deployment\n\nClaude: [investigate] Here's the timeline...\n\nYou: What changed before it started failing?\n\nClaude: [resource_changes] A ConfigMap was deleted 2 minutes before...\n"})}),"\n",(0,r.jsx)(n.h3,{id:"pattern-2-direct-deep-dive",children:"Pattern 2: Direct Deep Dive"}),"\n",(0,r.jsx)(n.p,{children:"When you know the problem resource:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"You: Investigate the deployment api-server in namespace production\n     from 30 minutes ago to now\n\nClaude: [investigate] Status transitions: Ready \u2192 Warning \u2192 Ready\n        Timeline shows rollback at 10:15...\n"})}),"\n",(0,r.jsx)(n.h3,{id:"pattern-3-time-based-analysis",children:"Pattern 3: Time-Based Analysis"}),"\n",(0,r.jsx)(n.p,{children:"For historical incidents:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"You: What happened in production between 10:00 and 10:30 today?\n\nClaude: [resource_changes] 5 high-impact changes detected...\n\nYou: Focus on the deployment changes\n\nClaude: [investigate each deployment] Here's what happened to each...\n"})}),"\n",(0,r.jsx)(n.h3,{id:"pattern-4-iterative-follow-up",children:"Pattern 4: Iterative Follow-Up"}),"\n",(0,r.jsx)(n.p,{children:"Build on previous responses:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"You: Show me cluster health for the last hour\n\nClaude: [cluster_health] Overall: Warning, 3 pods failing...\n\nYou: Investigate those failing pods\n\nClaude: [investigate for each pod] Pod 1: CrashLoopBackOff...\n\nYou: Were there any changes to their deployments recently?\n\nClaude: [resource_changes for deployments] Yes, deployment X was updated...\n"})}),"\n",(0,r.jsx)(n.h2,{id:"claude-desktop-configuration-reference",children:"Claude Desktop Configuration Reference"}),"\n",(0,r.jsx)(n.h3,{id:"config-file-schema",children:"Config File Schema"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "mcpServers": {\n    "<server-name>": {\n      "command": "<absolute-path-to-executable>",\n      "args": ["<arg1>", "<arg2>"],\n      "env": {\n        "<ENV_VAR>": "<value>"\n      },\n      "disabled": false  // Optional: set true to disable without removing\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"multiple-spectre-instances",children:"Multiple Spectre Instances"}),"\n",(0,r.jsx)(n.p,{children:"You can configure multiple Spectre connections:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "mcpServers": {\n    "spectre-dev": {\n      "command": "/usr/local/bin/spectre",\n      "args": ["mcp", "--api-url=http://localhost:8080", "--stdio"]\n    },\n    "spectre-prod": {\n      "command": "/usr/local/bin/spectre-mcp-kubectl.sh",\n      "env": {\n        "SPECTRE_NAMESPACE": "spectre-production"\n      }\n    }\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Usage"}),": Ask Claude to specify which instance:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"You: Use spectre-prod to check cluster health\n"})}),"\n",(0,r.jsx)(n.h3,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,r.jsx)(n.p,{children:"Available environment variables for wrapper scripts:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Variable"}),(0,r.jsx)(n.th,{children:"Purpose"}),(0,r.jsx)(n.th,{children:"Example"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"SPECTRE_API_URL"})}),(0,r.jsx)(n.td,{children:"Spectre API endpoint"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"http://localhost:8080"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"SPECTRE_LOG_LEVEL"})}),(0,r.jsx)(n.td,{children:"Logging verbosity"}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"debug"}),", ",(0,r.jsx)(n.code,{children:"info"}),", ",(0,r.jsx)(n.code,{children:"warn"}),", ",(0,r.jsx)(n.code,{children:"error"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"SPECTRE_NAMESPACE"})}),(0,r.jsx)(n.td,{children:"Default namespace for kubectl"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"spectre-system"})})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(n.h3,{id:"issue-claude-doesnt-see-spectre-tools",children:"Issue: Claude Doesn't See Spectre Tools"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptoms"}),": Claude responds \"I don't have access to Spectre tools\" or doesn't show MCP extensions."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Diagnosis"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Check config file location is correct for your OS"}),"\n",(0,r.jsxs)(n.li,{children:["Verify JSON syntax is valid (use ",(0,r.jsx)(n.code,{children:"jq"})," or online validator)"]}),"\n",(0,r.jsx)(n.li,{children:"Check Claude Desktop logs for errors"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Logs location"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"macOS"}),": ",(0,r.jsx)(n.code,{children:"~/Library/Logs/Claude/"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Windows"}),": ",(0,r.jsx)(n.code,{children:"%LOCALAPPDATA%\\Claude\\logs\\"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Linux"}),": ",(0,r.jsx)(n.code,{children:"~/.local/share/Claude/logs/"})]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Look for"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'[MCP] Failed to start server "spectre": command not found\n[MCP] Server "spectre" exited with code 1\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Common fixes"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Command not found"}),": Use absolute path to executable"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Permission denied"}),": ",(0,r.jsx)(n.code,{children:"chmod +x /path/to/spectre"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"JSON parse error"}),": Validate JSON syntax"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"issue-claude-says-tool-call-failed",children:'Issue: Claude Says "Tool Call Failed"'}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptoms"}),": Claude tries to call a tool but gets an error."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Diagnosis"}),": Check MCP server logs"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# If using wrapper script with LOG_FILE enabled:\ntail -f /tmp/spectre-mcp-claude.log\n\n# Or enable logging temporarily:\necho 'exec 2>> /tmp/spectre-mcp-debug.log' > /tmp/test-wrapper.sh\necho 'exec /usr/local/bin/spectre mcp --api-url=http://localhost:8080 --stdio' >> /tmp/test-wrapper.sh\nchmod +x /tmp/test-wrapper.sh\n\n# Update Claude config to use /tmp/test-wrapper.sh temporarily\n# Restart Claude, try tool again, check /tmp/spectre-mcp-debug.log\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Common errors"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:'"connection refused to localhost:8080"'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cause"}),": Spectre API not accessible"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Fix"}),": Start port-forward or verify Spectre is running"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:'"context deadline exceeded"'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cause"}),": Tool execution timed out"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Fix"}),": Check Spectre performance, reduce time window"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:'"no resources found"'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cause"}),": Spectre has no data for the requested time window"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Fix"}),": Verify Spectre is indexing events, adjust time window"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"issue-logs-show-failed-to-parse-json-rpc-request",children:'Issue: Logs Show "Failed to Parse JSON-RPC Request"'}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptoms"}),": MCP server logs show parse errors."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Cause"}),": This is usually a bug in Claude Desktop or the MCP server implementation."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Temporary fix"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Capture raw stdin/stdout for debugging\ncat > /tmp/spectre-mcp-debug-wrapper.sh << 'EOF'\n#!/bin/bash\ntee /tmp/mcp-stdin.log | \\\n  /usr/local/bin/spectre mcp --api-url=http://localhost:8080 --stdio | \\\n  tee /tmp/mcp-stdout.log\nEOF\n\nchmod +x /tmp/spectre-mcp-debug-wrapper.sh\n\n# Update Claude config to use debug wrapper\n# Restart Claude, try tool, inspect /tmp/mcp-stdin.log and /tmp/mcp-stdout.log\n"})}),"\n",(0,r.jsx)(n.h3,{id:"issue-port-forward-keeps-disconnecting",children:"Issue: Port-Forward Keeps Disconnecting"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptoms"}),": Tool calls work initially but fail after a few minutes."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Cause"}),": ",(0,r.jsx)(n.code,{children:"kubectl port-forward"})," can be unstable."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Fix"}),": Use a more stable connection method:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Option 1: kubefwd (more stable port-forwarding)\nsudo kubefwd svc -n spectre-system -l app.kubernetes.io/name=spectre\n\n# Option 2: Use kubectl exec instead (Setup Path 2, Option 2B)\n"})}),"\n",(0,r.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsx)(n.h3,{id:"-do",children:"\u2705 Do"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Be specific with time windows"}),': "last 30 minutes" is better than "recently"']}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Provide namespace context"}),": Mention namespace to speed up queries"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Use prompt names explicitly"}),': "Run post_mortem_incident_analysis from 10:00 to 11:00"']}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Follow up with kubectl commands"}),": Claude suggests kubectl commands - run them for complete analysis"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Ask Claude to explain"}),': "Why did you choose to investigate that resource?"']}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Iterate incrementally"}),": Start broad (cluster_health), then narrow down (investigate specific resources)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Keep port-forward running"}),": Ensure Spectre API stays accessible during investigations"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"-dont",children:"\u274c Don't"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Don't expect real-time logs"}),": Spectre tracks events, not container logs (use kubectl logs)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Don't rely solely on AI"}),": Verify recommendations before executing destructive commands"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Don't use for live incidents without backup plan"}),": Always have kubectl ready for manual intervention"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Don't share sensitive config"}),": Claude Desktop config may contain API URLs - keep it private"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Don't expect instant responses"}),": Large time windows or complex investigations may take 30-60 seconds"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Don't query very old data"}),": Check Spectre retention settings (default: 7 days)"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"security-considerations",children:"Security Considerations"}),"\n",(0,r.jsx)(n.h3,{id:"local-development",children:"Local Development"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Low risk"}),": MCP server runs locally, connects to port-forwarded API"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"No network exposure"}),": stdio transport doesn't open any ports"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Subprocess isolation"}),": Claude manages MCP server lifecycle"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"production-access",children:"Production Access"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u26a0\ufe0f Important"}),": Exposing Spectre API requires authentication"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Recommended approach"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"kubectl port-forward"})," (simplest, uses existing auth)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"kubectl exec"})," (runs MCP in-cluster)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"VPN + LoadBalancer"})," (for remote teams)"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"NOT recommended"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u274c Public LoadBalancer without auth"}),"\n",(0,r.jsx)(n.li,{children:"\u274c HTTP ingress without TLS + authentication"}),"\n",(0,r.jsx)(n.li,{children:"\u274c Shared API tokens in Claude config (visible in plain text)"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Future"}),": Spectre v2.0 will add built-in authentication for MCP server. Until then, rely on network-level security (VPN, kubectl auth, mTLS)."]}),"\n",(0,r.jsx)(n.h2,{id:"example-workflow-production-incident",children:"Example Workflow: Production Incident"}),"\n",(0,r.jsx)(n.p,{children:"End-to-end example of using Claude for real incident:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"[10:15 AM - Pagerduty alert: API 500 errors spiking]\n\nYou: Check production namespace cluster health right now\n\nClaude: [cluster_health] Found 5 pods in Error state, all in api-server deployment\n\nYou: Run live incident handling prompt\n\nClaude: [live_incident_handling prompt]\n        Incident started ~5 minutes ago\n        Timeline:\n        [10:10] Deployment api-server updated\n        [10:11] Pods started failing\n        [10:12] Service endpoints removed\n\n        Immediate mitigation:\n        kubectl rollout undo deployment/api-server -n production\n\nYou: [Runs rollback command]\n\nYou: Monitor recovery\n\nClaude: [cluster_health]\n        Rollback complete, 3/3 pods Running\n        Service endpoints restored\n\nYou: What changed before the incident?\n\nClaude: [resource_changes]\n        Deployment updated: image tag v1.2 \u2192 v1.3\n        ConfigMap api-config updated 30 seconds before deployment\n\nYou: Run post-mortem from 10:00 to 10:20\n\nClaude: [post_mortem_incident_analysis]\n        [Generates full report with recommendations]\n\n[10:20 AM - Incident resolved, post-mortem documented]\n"})}),"\n",(0,r.jsx)(n.h2,{id:"advanced-configuration",children:"Advanced Configuration"}),"\n",(0,r.jsx)(n.h3,{id:"custom-wrapper-script-with-debugging",children:"Custom Wrapper Script with Debugging"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n\n# Spectre MCP Wrapper with Debug Logging\n\nLOG_FILE="/tmp/spectre-mcp-$(date +%Y%m%d-%H%M%S).log"\nAPI_URL="${SPECTRE_API_URL:-http://localhost:8080}"\n\n# Log startup\necho "[$(date)] Starting Spectre MCP" >> "$LOG_FILE"\necho "[$(date)] API URL: $API_URL" >> "$LOG_FILE"\n\n# Redirect stderr to log file\nexec 2>> "$LOG_FILE"\n\n# Start MCP server\nexec /usr/local/bin/spectre mcp \\\n  --api-url="$API_URL" \\\n  --stdio \\\n  --log-level=debug\n'})}),"\n",(0,r.jsx)(n.h3,{id:"multiple-clusters-with-context-selection",children:"Multiple Clusters with Context Selection"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "mcpServers": {\n    "spectre-us-west": {\n      "command": "/usr/local/bin/spectre-mcp-kubectl.sh",\n      "env": {\n        "KUBECONFIG": "/Users/you/.kube/config-us-west",\n        "SPECTRE_NAMESPACE": "spectre-system"\n      }\n    },\n    "spectre-eu-central": {\n      "command": "/usr/local/bin/spectre-mcp-kubectl.sh",\n      "env": {\n        "KUBECONFIG": "/Users/you/.kube/config-eu-central",\n        "SPECTRE_NAMESPACE": "spectre-system"\n      }\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"integration-with-other-mcp-servers",children:"Integration with Other MCP Servers"}),"\n",(0,r.jsx)(n.p,{children:"Claude Desktop supports multiple MCP servers simultaneously:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "mcpServers": {\n    "spectre": {\n      "command": "/usr/local/bin/spectre-mcp-claude.sh"\n    },\n    "filesystem": {\n      "command": "npx",\n      "args": ["-y", "@modelcontextprotocol/server-filesystem", "/path/to/files"]\n    },\n    "database": {\n      "command": "mcp-server-postgres",\n      "args": ["postgresql://user:pass@localhost/db"]\n    }\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Usage"}),": Claude can use multiple tools together:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"You: Check Spectre for failing pods, then write a summary to incident-report.md\n\nClaude: [Uses Spectre tools to investigate]\n        [Uses filesystem MCP to write file]\n"})}),"\n",(0,r.jsx)(n.h2,{id:"limitations",children:"Limitations"}),"\n",(0,r.jsx)(n.h3,{id:"what-claude-can-do-with-spectre",children:"What Claude CAN Do with Spectre"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2705 Investigate Kubernetes events and resource status changes"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Identify high-impact changes and correlate failures"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Provide timeline reconstruction for incidents"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Generate investigation prompts for root cause analysis"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Browse and discover resources across namespaces"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Run pre-built prompts (post-mortem, live incident handling)"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"what-claude-cannot-do-yet",children:"What Claude CANNOT Do (Yet)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u274c Access container logs directly (Spectre doesn't index logs)"}),"\n",(0,r.jsx)(n.li,{children:"\u274c Execute kubectl commands (you must run suggested commands manually)"}),"\n",(0,r.jsx)(n.li,{children:"\u274c Access metrics (CPU, memory, network) - Spectre tracks events only"}),"\n",(0,r.jsx)(n.li,{children:"\u274c Modify cluster resources (read-only investigation)"}),"\n",(0,r.jsx)(n.li,{children:"\u274c Access external systems (Prometheus, Datadog, etc.)"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"bridging-the-gap",children:"Bridging the Gap"}),"\n",(0,r.jsx)(n.p,{children:"For complete investigations, combine Claude + manual steps:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Claude investigates events"})," \u2192 Identifies likely cause and affected resources"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"You run kubectl logs"})," \u2192 Get container error messages"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"You check metrics"})," \u2192 Verify CPU/memory issues"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Claude synthesizes findings"}),' \u2192 "Based on the logs you shared, the issue is..."']}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/spectre/docs/mcp-integration/getting-started",children:"Getting Started with MCP"})," - Initial MCP deployment and verification"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/spectre/docs/configuration/mcp-configuration",children:"MCP Configuration Guide"})," - Complete configuration reference"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/spectre/docs/mcp-integration/tools-reference/cluster-health",children:"Tools Reference"})," - Detailed API documentation for all 4 tools"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/spectre/docs/mcp-integration/prompts-reference/post-mortem",children:"Prompts Reference"})," - Workflow guides for pre-built prompts"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/spectre/docs/mcp-integration/examples",children:"Real-World Examples"})," - Complete investigation scenarios"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://modelcontextprotocol.io",children:"MCP Protocol Specification"})," - Official MCP documentation"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>l});var t=s(6540);const r={},i=t.createContext(r);function o(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);