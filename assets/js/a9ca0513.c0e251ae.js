"use strict";(globalThis.webpackChunkspectre_docs=globalThis.webpackChunkspectre_docs||[]).push([[56],{921:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"mcp-integration/prompts-reference/post-mortem","title":"post_mortem_incident_analysis Prompt","description":"Comprehensive post-mortem analysis with systematic investigation workflow","source":"@site/docs/mcp-integration/prompts-reference/post-mortem.md","sourceDirName":"mcp-integration/prompts-reference","slug":"/mcp-integration/prompts-reference/post-mortem","permalink":"/spectre/docs/mcp-integration/prompts-reference/post-mortem","draft":false,"unlisted":false,"editUrl":"https://github.com/moolen/spectre/tree/master/docs/docs/mcp-integration/prompts-reference/post-mortem.md","tags":[],"version":"current","lastUpdatedBy":"Moritz Johner","lastUpdatedAt":1765616329000,"frontMatter":{"title":"post_mortem_incident_analysis Prompt","description":"Comprehensive post-mortem analysis with systematic investigation workflow","keywords":["mcp","prompts","post-mortem","rca","incident","analysis"]},"sidebar":"docsSidebar","previous":{"title":"resource_explorer Tool","permalink":"/spectre/docs/mcp-integration/tools-reference/resource-explorer"},"next":{"title":"live_incident_handling Prompt","permalink":"/spectre/docs/mcp-integration/prompts-reference/live-incident"}}');var t=s(4848),r=s(8453);const o={title:"post_mortem_incident_analysis Prompt",description:"Comprehensive post-mortem analysis with systematic investigation workflow",keywords:["mcp","prompts","post-mortem","rca","incident","analysis"]},l="post_mortem_incident_analysis Prompt",c={},d=[{value:"Overview",id:"overview",level:2},{value:"Arguments",id:"arguments",level:2},{value:"Timestamp Format",id:"timestamp-format",level:3},{value:"Time Window Guidelines",id:"time-window-guidelines",level:3},{value:"Workflow",id:"workflow",level:2},{value:"Step 1: Confirm Parameters",id:"step-1-confirm-parameters",level:3},{value:"Step 2: Cluster Health Overview",id:"step-2-cluster-health-overview",level:3},{value:"Step 3: Identify High-Impact Changes",id:"step-3-identify-high-impact-changes",level:3},{value:"Step 4: Investigate Critical Resources",id:"step-4-investigate-critical-resources",level:3},{value:"Step 5: Explore Related Resources",id:"step-5-explore-related-resources",level:3},{value:"Step 6: Build Chronological Timeline",id:"step-6-build-chronological-timeline",level:3},{value:"Step 7: Root Cause Analysis",id:"step-7-root-cause-analysis",level:3},{value:"Step 8: Impact Assessment &amp; Recommendations",id:"step-8-impact-assessment--recommendations",level:3},{value:"Step 9: Identify Data Gaps",id:"step-9-identify-data-gaps",level:3},{value:"Key Features",id:"key-features",level:2},{value:"1. No Hallucinations",id:"1-no-hallucinations",level:3},{value:"2. Grounded Analysis",id:"2-grounded-analysis",level:3},{value:"3. Log Guidance",id:"3-log-guidance",level:3},{value:"4. Acknowledges Gaps",id:"4-acknowledges-gaps",level:3},{value:"5. Structured Output",id:"5-structured-output",level:3},{value:"Usage Examples",id:"usage-examples",level:2},{value:"Example 1: Via Claude Desktop (Natural Language)",id:"example-1-via-claude-desktop-natural-language",level:3},{value:"Example 2: Via MCP API (Direct Prompt Call)",id:"example-2-via-mcp-api-direct-prompt-call",level:3},{value:"Example 3: Deployment Failure",id:"example-3-deployment-failure",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"\u2705 Do",id:"-do",level:3},{value:"\u274c Don&#39;t",id:"-dont",level:3},{value:"Related Documentation",id:"related-documentation",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"post_mortem_incident_analysis-prompt",children:"post_mortem_incident_analysis Prompt"})}),"\n",(0,t.jsx)(n.p,{children:"Comprehensive post-mortem analysis of past incidents with systematic investigation workflow and root cause analysis."}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"post_mortem_incident_analysis"})," prompt guides an LLM through a structured investigation of historical incidents, ensuring grounded analysis with no hallucinations."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Key Capabilities:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Systematic 9-Step Workflow"}),": Structured investigation from overview to recommendations"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Grounded Analysis"}),": All claims traceable to actual tool outputs"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"No Hallucinations"}),": Only reports events present in tool responses"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Chronological Timeline"}),": Exact timestamps and event sequences"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Root Cause Analysis"}),": Identifies contributing factors with evidence"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Impact Assessment"}),": Documents incident scope and affected resources"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Preventive Measures"}),": Actionable recommendations to prevent recurrence"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Data Gap Identification"}),": Acknowledges missing information and suggests additional investigation"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"When to Use:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Post-mortem analysis after incident resolution"}),"\n",(0,t.jsx)(n.li,{children:"Historical incident investigation for documentation"}),"\n",(0,t.jsx)(n.li,{children:"Root cause analysis for recurring issues"}),"\n",(0,t.jsx)(n.li,{children:"Compliance and audit requirements"}),"\n",(0,t.jsx)(n.li,{children:"Learning from production incidents"}),"\n",(0,t.jsx)(n.li,{children:"Building incident response knowledge base"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"When NOT to Use:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Live incident troubleshooting (use ",(0,t.jsx)(n.code,{children:"live_incident_handling"})," instead)"]}),"\n",(0,t.jsx)(n.li,{children:"Real-time monitoring or alerting"}),"\n",(0,t.jsxs)(n.li,{children:["Routine health checks (use ",(0,t.jsx)(n.code,{children:"cluster_health"})," tool directly)"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"arguments",children:"Arguments"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Argument"}),(0,t.jsx)(n.th,{children:"Type"}),(0,t.jsx)(n.th,{children:"Required"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"start_time"})}),(0,t.jsx)(n.td,{children:"int64"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Yes"})}),(0,t.jsx)(n.td,{children:"Start of incident window (Unix timestamp in seconds or milliseconds)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"end_time"})}),(0,t.jsx)(n.td,{children:"int64"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Yes"})}),(0,t.jsx)(n.td,{children:"End of incident window (Unix timestamp in seconds or milliseconds)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"namespace"})}),(0,t.jsx)(n.td,{children:"string"}),(0,t.jsx)(n.td,{children:"No"}),(0,t.jsx)(n.td,{children:"Kubernetes namespace to focus investigation (optional)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"incident_description"})}),(0,t.jsx)(n.td,{children:"string"}),(0,t.jsx)(n.td,{children:"No"}),(0,t.jsx)(n.td,{children:"Brief context about the incident (optional)"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"timestamp-format",children:"Timestamp Format"}),"\n",(0,t.jsxs)(n.p,{children:["Both ",(0,t.jsx)(n.strong,{children:"Unix seconds"})," and ",(0,t.jsx)(n.strong,{children:"Unix milliseconds"})," are supported:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Unix seconds: 1702382400\nUnix milliseconds: 1702382400000\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Getting timestamps"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# Start time (Dec 12, 2024 10:00 AM UTC)\ndate -u -d "2024-12-12 10:00:00" +%s\n# Output: 1702382400\n\n# End time (Dec 12, 2024 11:00 AM UTC)\ndate -u -d "2024-12-12 11:00:00" +%s\n# Output: 1702386000\n'})}),"\n",(0,t.jsx)(n.h3,{id:"time-window-guidelines",children:"Time Window Guidelines"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Window"}),(0,t.jsx)(n.th,{children:"Use Case"}),(0,t.jsx)(n.th,{children:"Analysis Depth"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"5-15 minutes"}),(0,t.jsx)(n.td,{children:"Specific incident (deployment failure, pod crash)"}),(0,t.jsx)(n.td,{children:"Very detailed"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"30-60 minutes"}),(0,t.jsx)(n.td,{children:"Service degradation, partial outage"}),(0,t.jsx)(n.td,{children:"Detailed"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"1-2 hours"}),(0,t.jsx)(n.td,{children:"Complete incident lifecycle"}),(0,t.jsx)(n.td,{children:"Standard depth"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"2-4 hours"}),(0,t.jsx)(n.td,{children:"Complex incident with multiple phases"}),(0,t.jsx)(n.td,{children:"Comprehensive"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"4+ hours"}),(0,t.jsx)(n.td,{children:"Extended outage, multi-system issues"}),(0,t.jsx)(n.td,{children:"High-level overview + detailed critical periods"})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Recommendation"}),": Include 15-30 minutes before symptom onset to capture precursor events."]}),"\n",(0,t.jsx)(n.h2,{id:"workflow",children:"Workflow"}),"\n",(0,t.jsx)(n.p,{children:"The prompt guides the LLM through a systematic 9-step investigation:"}),"\n",(0,t.jsx)(n.h3,{id:"step-1-confirm-parameters",children:"Step 1: Confirm Parameters"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"What happens"}),": LLM confirms the investigation scope"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Output"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'Investigating incident from [start_time] to [end_time]\nNamespace filter: [namespace] (or "all namespaces")\nContext: [incident_description] (if provided)\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Purpose"}),": Establish investigation boundaries and focus"]}),"\n",(0,t.jsx)(n.h3,{id:"step-2-cluster-health-overview",children:"Step 2: Cluster Health Overview"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Tool called"}),": ",(0,t.jsx)(n.code,{children:"cluster_health"})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Parameters"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "start_time": "<incident_start_time>",\n  "end_time": "<incident_end_time>",\n  "namespace": "<namespace>" // if provided\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"What it provides"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Overall cluster status during incident"}),"\n",(0,t.jsx)(n.li,{children:"Resources by kind with status breakdown"}),"\n",(0,t.jsx)(n.li,{children:"Top issues encountered"}),"\n",(0,t.jsx)(n.li,{children:"Error/warning resource counts"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Purpose"}),": Understand incident scope and severity"]}),"\n",(0,t.jsx)(n.h3,{id:"step-3-identify-high-impact-changes",children:"Step 3: Identify High-Impact Changes"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Tool called"}),": ",(0,t.jsx)(n.code,{children:"resource_changes"})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Parameters"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "start_time": "<incident_start_time>",\n  "end_time": "<incident_end_time>",\n  "impact_threshold": 0.3,\n  "max_resources": 30\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"What it provides"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Resources with high impact scores"}),"\n",(0,t.jsx)(n.li,{children:"Status transitions"}),"\n",(0,t.jsx)(n.li,{children:"Error and warning counts"}),"\n",(0,t.jsx)(n.li,{children:"Change correlation"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Purpose"}),": Identify what changed during the incident"]}),"\n",(0,t.jsx)(n.h3,{id:"step-4-investigate-critical-resources",children:"Step 4: Investigate Critical Resources"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Tool called"}),": ",(0,t.jsx)(n.code,{children:"investigate"})," (for top 3-5 resources from Step 3)"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Parameters"})," (per resource):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "resource_kind": "<kind>",\n  "resource_name": "<name>",\n  "namespace": "<namespace>",\n  "start_time": "<incident_start_time>",\n  "end_time": "<incident_end_time>",\n  "investigation_type": "post-mortem"\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"What it provides"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Detailed timeline with status segments"}),"\n",(0,t.jsx)(n.li,{children:"Kubernetes events"}),"\n",(0,t.jsx)(n.li,{children:"Investigation prompts for RCA"}),"\n",(0,t.jsx)(n.li,{children:"Resource snapshots at transitions"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Purpose"}),": Deep dive into root cause candidates"]}),"\n",(0,t.jsx)(n.h3,{id:"step-5-explore-related-resources",children:"Step 5: Explore Related Resources"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Tool called"}),": ",(0,t.jsx)(n.code,{children:"resource_explorer"})," (optional, as needed)"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Parameters"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "kind": "<related_kind>",\n  "namespace": "<namespace>",\n  "status": "Error"\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"What it provides"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Broader context of related failures"}),"\n",(0,t.jsx)(n.li,{children:"Resource inventory at incident time"}),"\n",(0,t.jsx)(n.li,{children:"Cross-resource impact patterns"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Purpose"}),": Identify cascading failures or dependencies"]}),"\n",(0,t.jsx)(n.h3,{id:"step-6-build-chronological-timeline",children:"Step 6: Build Chronological Timeline"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"LLM synthesizes"})," tool results into timeline:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"[10:00:05] Deployment/production/api-server - Updated image v1.2.0 \u2192 v1.3.0\n[10:00:32] Pod/production/api-server-85f6c9b8-k4x2p - Transitioned Running \u2192 Error\n[10:00:45] Pod/production/api-server-85f6c9b8-k4x2p - Event: BackOff (count: 3)\n[10:01:12] Service/production/api-server - Endpoint removed (no ready pods)\n[10:05:47] Deployment/production/api-server - Rolled back to v1.2.0\n[10:06:15] Pod/production/api-server-7d9f8c5b-z9k3p - Transitioned Pending \u2192 Running\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Purpose"}),": Visualize incident progression with exact timing"]}),"\n",(0,t.jsx)(n.h3,{id:"step-7-root-cause-analysis",children:"Step 7: Root Cause Analysis"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"LLM analyzes"})," investigation_prompts and tool results:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Root Cause:\n- Image tag v1.3.0 had incorrect environment variable configuration\n- Pod failed to start due to missing CONFIG_URL variable\n- CrashLoopBackOff prevented service availability\n\nContributing Factors:\n1. No pre-deployment validation of container startup\n2. Missing health check delay allowed traffic before readiness\n3. Rollback took 5 minutes (manual process)\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Purpose"}),": Identify primary cause and contributing factors"]}),"\n",(0,t.jsx)(n.h3,{id:"step-8-impact-assessment--recommendations",children:"Step 8: Impact Assessment & Recommendations"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"LLM documents"}),":"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Impact"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Service downtime: 5 minutes 42 seconds"}),"\n",(0,t.jsx)(n.li,{children:"Affected resources: 1 Deployment, 3 Pods, 1 Service"}),"\n",(0,t.jsx)(n.li,{children:"Error rate: 100% during outage"}),"\n",(0,t.jsx)(n.li,{children:"Customer impact: API unavailable"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Preventive Measures"}),":"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Add startup validation in CI/CD pipeline"}),"\n",(0,t.jsx)(n.li,{children:"Implement health check initialDelaySeconds"}),"\n",(0,t.jsx)(n.li,{children:"Automate rollback detection and execution"}),"\n",(0,t.jsx)(n.li,{children:"Add alerting for pod CrashLoopBackOff"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Purpose"}),": Document impact and prevent recurrence"]}),"\n",(0,t.jsx)(n.h3,{id:"step-9-identify-data-gaps",children:"Step 9: Identify Data Gaps"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"LLM lists"})," missing information:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Additional Investigation Needed:\n1. kubectl logs api-server-85f6c9b8-k4x2p --previous\n   \u2192 Check exact container error message\n2. kubectl describe pod api-server-85f6c9b8-k4x2p\n   \u2192 Verify environment variable configuration\n3. Review CI/CD logs for build v1.3.0\n   \u2192 Understand configuration change origin\n4. Check application metrics (Prometheus/Datadog)\n   \u2192 Correlate with external monitoring\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Purpose"}),": Guide follow-up investigation"]}),"\n",(0,t.jsx)(n.h2,{id:"key-features",children:"Key Features"}),"\n",(0,t.jsx)(n.h3,{id:"1-no-hallucinations",children:"1. No Hallucinations"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"How it works"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:'Prompt explicitly instructs: "Only report events present in tool responses"'}),"\n",(0,t.jsx)(n.li,{children:"LLM must quote exact timestamps, resource names, and messages"}),"\n",(0,t.jsx)(n.li,{children:"Forbidden to infer events not in data"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'\u2705 Good: "At 10:00:32, Pod api-server-85f6c9b8-k4x2p transitioned to Error status"\n         (Directly from investigate tool output)\n\n\u274c Bad: "The database likely became overloaded"\n        (Speculation without evidence from tools)\n'})}),"\n",(0,t.jsx)(n.h3,{id:"2-grounded-analysis",children:"2. Grounded Analysis"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"How it works"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"All claims must be traceable to specific tool output"}),"\n",(0,t.jsxs)(n.li,{children:["Uses investigation_prompts from ",(0,t.jsx)(n.code,{children:"investigate"})," tool as RCA guidance"]}),"\n",(0,t.jsx)(n.li,{children:"References exact field values from tool responses"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'\u2705 Good: "impact_score: 0.75 indicates high impact due to:\n         - error_events: 3 (+0.30)\n         - status transition Running \u2192 Error (+0.30)\n         - event_count: 18 (+0.10)"\n         (Based on resource_changes output)\n\n\u274c Bad: "This was a high-impact incident"\n        (Vague claim without supporting data)\n'})}),"\n",(0,t.jsx)(n.h3,{id:"3-log-guidance",children:"3. Log Guidance"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"How it works"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Prompt instructs LLM to recommend specific kubectl commands"}),"\n",(0,t.jsx)(n.li,{children:"Suggests cloud logging queries (CloudWatch, Stackdriver, etc.)"}),"\n",(0,t.jsx)(n.li,{children:"Points to external observability tools when appropriate"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Additional Logs to Review:\n1. kubectl logs nginx-7d8b5f9c6b-x7k2p --previous\n   \u2192 Container exit reason and error messages\n2. kubectl describe pod nginx-7d8b5f9c6b-x7k2p\n   \u2192 Full event history and configuration\n3. AWS CloudWatch Logs: /aws/eks/production/cluster\n   \u2192 Node-level issues or kubelet errors\n"})}),"\n",(0,t.jsx)(n.h3,{id:"4-acknowledges-gaps",children:"4. Acknowledges Gaps"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"How it works"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Prompt requires LLM to state when information is missing"}),"\n",(0,t.jsx)(n.li,{children:"Explicitly marks hypotheses vs. confirmed facts"}),"\n",(0,t.jsx)(n.li,{children:"Lists specific commands/queries needed to fill gaps"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Data Gaps:\n- Container logs not available (requires kubectl logs --previous)\n- Application metrics not in Spectre data (check Prometheus)\n- Network policy changes unknown (review audit logs)\n\nHypothesis (Unconfirmed):\n- Pod may have exceeded memory limit (requires kubectl describe pod)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"5-structured-output",children:"5. Structured Output"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Expected sections"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-markdown",children:"## Incident Summary\n[Brief overview]\n\n## Timeline\n[Chronological event list with exact timestamps]\n\n## Root Cause Analysis\n[Primary cause + contributing factors with evidence]\n\n## Impact Assessment\n[Affected resources, downtime duration, user impact]\n\n## Recommendations\n[Preventive measures, process improvements, automation opportunities]\n\n## Data Gaps & Follow-Up\n[Missing information, kubectl commands, additional logs to review]\n"})}),"\n",(0,t.jsx)(n.h2,{id:"usage-examples",children:"Usage Examples"}),"\n",(0,t.jsx)(n.h3,{id:"example-1-via-claude-desktop-natural-language",children:"Example 1: Via Claude Desktop (Natural Language)"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"User"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Analyze the incident from 10:00 AM to 11:00 AM on December 12, 2024 in the production namespace\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"What happens"}),":"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Claude recognizes this as a post-mortem request"}),"\n",(0,t.jsx)(n.li,{children:"Converts timestamps to Unix format"}),"\n",(0,t.jsxs)(n.li,{children:["Calls ",(0,t.jsx)(n.code,{children:"post_mortem_incident_analysis"})," prompt"]}),"\n",(0,t.jsx)(n.li,{children:"Executes 9-step workflow"}),"\n",(0,t.jsx)(n.li,{children:"Returns structured analysis"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"LLM Output"})," (abbreviated):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'## Incident Summary\nDeployment update to api-server v1.3.0 caused 5min 42sec service outage due to\nmissing environment variable configuration.\n\n## Timeline\n[10:00:05] Deployment/production/api-server - Image updated v1.2.0 \u2192 v1.3.0\n[10:00:32] Pod/production/api-server-85f6c9b8-k4x2p - Status Running \u2192 Error\n[10:00:45] Event: BackOff - Back-off restarting failed container (count: 15)\n...\n\n## Root Cause Analysis\nPrimary Cause: Container v1.3.0 missing CONFIG_URL environment variable\n\nContributing Factors:\n1. No pre-deployment validation\n2. Manual rollback process (5min delay)\n\nEvidence:\n- investigate tool showed status transition at 10:00:32\n- resource_changes impact_score: 0.75 (high)\n- Event message: "Back-off restarting failed container"\n\n## Recommendations\n1. Add container startup validation to CI/CD\n2. Implement automated rollback on CrashLoopBackOff\n...\n\n## Data Gaps\nNeed: kubectl logs api-server-85f6c9b8-k4x2p --previous\n'})}),"\n",(0,t.jsx)(n.h3,{id:"example-2-via-mcp-api-direct-prompt-call",children:"Example 2: Via MCP API (Direct Prompt Call)"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Request"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "jsonrpc": "2.0",\n  "method": "prompts/get",\n  "params": {\n    "name": "post_mortem_incident_analysis",\n    "arguments": {\n      "start_time": 1702382400,\n      "end_time": 1702386000,\n      "namespace": "production",\n      "incident_description": "API service degradation - 500 errors"\n    }\n  },\n  "id": 1\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Response"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "jsonrpc": "2.0",\n  "result": {\n    "description": "Prompt: post_mortem_incident_analysis",\n    "messages": [\n      {\n        "role": "user",\n        "content": {\n          "type": "text",\n          "text": "Execute prompt post_mortem_incident_analysis..."\n        }\n      }\n    ]\n  },\n  "id": 1\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Note"}),": The prompt is then executed by the LLM, which calls tools and generates the structured analysis."]}),"\n",(0,t.jsx)(n.h3,{id:"example-3-deployment-failure",children:"Example 3: Deployment Failure"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"User"})," (Claude Desktop):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Analyze deployment failure for api-server from 10:15 to 10:30 this morning\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Tools Called by Prompt"}),":"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"cluster_health"})," \u2192 Found Deployment in Warning state"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"resource_changes"})," \u2192 impact_score: 0.45 for api-server Deployment"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"investigate"})," (Deployment) \u2192 Status: Ready \u2192 Warning \u2192 Ready"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"investigate"})," (Pods) \u2192 3 pods failed to start"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"RCA Output"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Root Cause: Resource quota exceeded during scale-up\n\nTimeline:\n[10:15:00] Deployment scaled 3 \u2192 5 replicas\n[10:15:12] Event: FailedCreate - exceeded quota\n[10:16:45] Deployment Warning - ReplicaFailure\n[10:28:00] Quota increased\n[10:28:30] Pods successfully created\n\nRecommendations:\n1. Increase default namespace quota\n2. Add quota monitoring alerts\n3. Implement progressive rollout (1 pod at a time)\n"})}),"\n",(0,t.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsx)(n.h3,{id:"-do",children:"\u2705 Do"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Include precursor time"})," - Start 15-30 minutes before symptoms"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Provide context"})," - Use ",(0,t.jsx)(n.code,{children:"incident_description"})," for focused analysis"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Review tool outputs"})," - Verify LLM grounded analysis in actual data"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Follow log guidance"})," - Run suggested kubectl commands"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Document findings"})," - Save structured output for incident reports"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Use for learning"})," - Build runbooks from RCA recommendations"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Verify timestamps"})," - Check timeline matches your incident logs"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Cross-reference"})," - Compare with external monitoring tools"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"-dont",children:"\u274c Don't"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Don't omit namespace"})," - Speeds up analysis when incident is scoped"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Don't ignore data gaps"})," - Follow up with suggested kubectl commands"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Don't trust without verification"})," - LLMs can make mistakes despite grounding"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Don't use for live incidents"})," - Use ",(0,t.jsx)(n.code,{children:"live_incident_handling"})," instead"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Don't expect logs"})," - Prompt cannot access container logs"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Don't query very old incidents"})," - Check Spectre retention first"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Don't assume completeness"})," - Analysis limited to Spectre data"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Don't skip recommendations"})," - Implement preventive measures"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/spectre/docs/mcp-integration/prompts-reference/live-incident",children:"live_incident_handling Prompt"})," - Real-time incident response"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/spectre/docs/mcp-integration/tools-reference/cluster-health",children:"cluster_health Tool"})," - Cluster overview (used by prompt)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/spectre/docs/mcp-integration/tools-reference/resource-changes",children:"resource_changes Tool"})," - Change identification (used by prompt)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/spectre/docs/mcp-integration/tools-reference/investigate",children:"investigate Tool"})," - Resource deep dive (used by prompt)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/spectre/docs/mcp-integration/tools-reference/resource-explorer",children:"resource_explorer Tool"})," - Resource discovery (used by prompt)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/spectre/docs/configuration/mcp-configuration",children:"MCP Configuration"})," - MCP server setup"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>l});var i=s(6540);const t={},r=i.createContext(t);function o(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);