# Milestone v1.1: Server Consolidation

**Status:** SHIPPED 2026-01-21
**Phases:** 6-9
**Total Plans:** 12

## Overview

Consolidate MCP server into main Spectre server for single-port deployment and in-process tool execution. Eliminates MCP sidecar container, reduces deployment complexity, and improves performance through shared service layer.

This roadmap delivered 21 v1.1 requirements across 4 phases, progressing from server consolidation through service layer extraction, Helm cleanup, and E2E validation.

## Phases

### Phase 6: Consolidated Server & Integration Manager

**Goal:** Single server binary serves REST API, UI, and MCP on port 8080 with in-process integration manager.
**Depends on:** None (foundation for v1.1)
**Plans:** 2 plans

Plans:
- [x] 06-01-PLAN.md — Integrate MCP server into main server with StreamableHTTP transport and integration manager
- [x] 06-02-PLAN.md — Verify consolidated server with MCP endpoint, integrations, and graceful shutdown

**Details:**
- Requirements: SRVR-01, SRVR-02, SRVR-03, SRVR-04, INTG-01, INTG-02, INTG-03
- Single port 8080 serves REST API, UI, and MCP (/v1/mcp endpoint)
- StreamableHTTP transport with stateless mode
- --stdio flag for stdio transport alongside HTTP
- MCPToolRegistry adapter for integration tool registration
- Graceful shutdown handling all components

---

### Phase 7: Service Layer Extraction

**Goal:** REST handlers and MCP tools share common service layer for timeline, graph, and metadata operations.
**Depends on:** Phase 6
**Plans:** 5 plans

Plans:
- [x] 07-01-PLAN.md — Complete TimelineService and wire REST handlers and MCP tools (resource_timeline, cluster_health)
- [x] 07-02-PLAN.md — Create GraphService and wire REST handlers and MCP tools (causal_paths, detect_anomalies)
- [x] 07-03-PLAN.md — Create SearchService and refactor REST search handler
- [x] 07-04-PLAN.md — Create MetadataService with cache integration and refactor REST metadata handler
- [x] 07-05-PLAN.md — Delete HTTP client code (internal/mcp/client/client.go)

**Details:**
- Requirements: SRVC-01, SRVC-02, SRVC-03, SRVC-04, SRVC-05
- TimelineService (615 lines) used by REST handler + 4 MCP tools
- GraphService (118 lines) used by 3 REST handlers + 2 MCP tools
- SearchService (155 lines) used by REST handler
- MetadataService (200 lines) used by REST handler
- HTTP client completely removed

---

### Phase 8: Cleanup & Helm Chart Update

**Goal:** Remove standalone MCP command and update Helm chart for single-container deployment.
**Depends on:** Phase 6, Phase 7
**Plans:** 3 plans

Plans:
- [x] 08-01-PLAN.md — Remove standalone mcp/agent/mock commands and internal/agent package
- [x] 08-02-PLAN.md — Update Helm chart templates and values to remove MCP sidecar
- [x] 08-03-PLAN.md — Update project and Helm chart documentation

**Details:**
- Requirements: SRVR-05, HELM-01, HELM-02, HELM-03, HELM-04
- Deleted 14,676 lines of dead code (74 files)
- mcp/agent/mock commands removed
- internal/agent package removed
- Helm chart single-container deployment
- values.yaml mcp: section removed (49 lines)

---

### Phase 9: E2E Test Validation

**Goal:** E2E tests verify consolidated architecture works for MCP HTTP and config reload scenarios.
**Depends on:** Phase 8
**Plans:** 2 plans

Plans:
- [x] 09-01-PLAN.md — Update MCP endpoint and port references for consolidated architecture
- [x] 09-02-PLAN.md — Remove stdio tests and verify E2E suite

**Details:**
- Requirements: TEST-01, TEST-02, TEST-03, TEST-04
- MCP HTTP tests use port 8080 at /v1/mcp
- Stdio tests removed (3 files, 743 lines)
- Config reload tests verify hot-reload
- No port 8082 references in production tests

---

## Milestone Summary

**Decimal Phases:** None

**Key Decisions:**
- Phase 6: Use /v1/mcp path (not /mcp) for API versioning consistency
- Phase 6: Use --stdio flag (not --transport=stdio) for simpler interface
- Phase 6: StreamableHTTP with stateless mode for client compatibility
- Phase 7: HTTP client completely removed, service-only architecture
- Phase 7: Standalone mcp/agent commands disabled (need gRPC refactor)

**Issues Resolved:**
- MCP tools HTTP self-calls eliminated (service layer)
- Handler business logic centralized in services

**Issues Deferred:**
- None

**Technical Debt Incurred:**
- None (Phase 8 cleaned up prior tech debt)

---

*For current project status, see .planning/PROJECT.md*
*Archived: 2026-01-21 as part of v1.1 milestone completion*
