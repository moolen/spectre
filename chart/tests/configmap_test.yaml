suite: test configmap
templates:
  - configmap.yaml
tests:
  - it: should create ConfigMap
    asserts:
      - isKind:
          of: ConfigMap
      - equal:
          path: metadata.name
          value: RELEASE-NAME-spectre
      - equal:
          path: metadata.namespace
          value: monitoring

  - it: should have correct labels
    asserts:
      - isSubset:
          path: metadata.labels
          content:
            app.kubernetes.io/name: spectre
            app.kubernetes.io/instance: RELEASE-NAME

  - it: should contain watcher configuration with default resources
    asserts:
      - isNotNull:
          path: data["watcher.yaml"]
      - matchRegex:
          path: data["watcher.yaml"]
          pattern: 'kind: "Pod"'
      - matchRegex:
          path: data["watcher.yaml"]
          pattern: 'kind: "Deployment"'
      - matchRegex:
          path: data["watcher.yaml"]
          pattern: 'kind: "Service"'
      - matchRegex:
          path: data["watcher.yaml"]
          pattern: 'kind: "Node"'

  - it: should render custom watcher resources
    set:
      config:
        watcher:
          resources:
            - group: ""
              version: "v1"
              kind: "Secret"
            - group: "batch"
              version: "v1"
              kind: "Job"
    asserts:
      - matchRegex:
          path: data["watcher.yaml"]
          pattern: 'kind: "Secret"'
      - matchRegex:
          path: data["watcher.yaml"]
          pattern: 'kind: "Job"'
      - matchRegex:
          path: data["watcher.yaml"]
          pattern: 'group: "batch"'
